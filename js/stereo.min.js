/* stereo
*  
* Copyright (c) 2015
* Johannes Burstr√∂m, johannes@ljud.org
* stereo may be freely distributed under the MIT license.
*/
!function(a,b){"use strict";function c(c,d){function e(a){return qb.preferFlash&&jb&&!qb.ignoreFlash&&qb.flash[a]!==b&&qb.flash[a]}function f(a){return function(b){var c,d=this._s;return d&&d._a?c=a.call(this,b):(qb._wD(d&&d.id?d.id+": Ignoring "+b.type:vb+"Ignoring "+b.type),c=null),c}}this.setupOptions={url:c||null,flashVersion:8,debugMode:!0,debugFlash:!1,useConsole:!0,consoleOnly:!0,waitForWindowLoad:!1,bgColor:"#ffffff",useHighPerformance:!1,flashPollingInterval:null,html5PollingInterval:null,flashLoadTimeout:1e3,wmode:null,allowScriptAccess:"always",useFlashBlock:!1,useHTML5Audio:!0,html5Test:/^(probably|maybe)$/i,preferFlash:!1,noSWFCache:!1,idPrefix:"sound"},this.defaultOptions={autoLoad:!1,autoPlay:!1,from:null,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onposition:null,onstop:null,onfailure:null,onfinish:null,multiShot:!0,multiShotEvents:!1,position:null,pan:0,stream:!0,to:null,type:null,usePolicyFile:!1,volume:100},this.flash9Options={isMovieStar:null,usePeakData:!1,useWaveformData:!1,useEQData:!1,onbufferchange:null,ondataerror:null},this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null},this.audioFormats={mp3:{type:['audio/mpeg; codecs="mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:!0},mp4:{related:["aac","m4a","m4b"],type:['audio/mp4; codecs="mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:!1},ogg:{type:["audio/ogg; codecs=vorbis"],required:!1},opus:{type:["audio/ogg; codecs=opus","audio/opus"],required:!1},wav:{type:['audio/wav; codecs="1"',"audio/wav","audio/wave","audio/x-wav"],required:!1}},this.movieID="sm2-container",this.id=d||"sm2movie",this.debugID="soundmanager-debug",this.debugURLParam=/([#?&])debug=1/i,this.versionNumber="V2.97a.20131201",this.version=null,this.movieURL=null,this.altURL=null,this.swfLoaded=!1,this.enabled=!1,this.oMC=null,this.sounds={},this.soundIDs=[],this.muted=!1,this.didFlashBlock=!1,this.filePattern=null,this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i},this.features={buffering:!1,peakData:!1,waveformData:!1,eqData:!1,movieStar:!1},this.sandbox={type:null,types:{remote:"remote (domain-based) rules",localWithFile:"local with file access (no internet access)",localWithNetwork:"local with network (internet access only, no local access)",localTrusted:"local, trusted (local+internet access)"},description:null,noRemote:null,noLocal:null},this.html5={usingFlash:null},this.flash={},this.html5Only=!1,this.ignoreFlash=!1;var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb=this,rb=null,sb=null,tb="soundManager",ub=tb+": ",vb="HTML5::",wb=navigator.userAgent,xb=a.location.href.toString(),yb=document,zb=[],Ab=!0,Bb=!1,Cb=!1,Db=!1,Eb=!1,Fb=!1,Gb=0,Hb=["log","info","warn","error"],Ib=8,Jb=null,Kb=null,Lb=!1,Mb=!1,Nb=0,Ob=null,Pb=[],Qb=null,Rb=Array.prototype.slice,Sb=!1,Tb=0,Ub=wb.match(/(ipad|iphone|ipod)/i),Vb=wb.match(/android/i),Wb=wb.match(/msie/i),Xb=wb.match(/webkit/i),Yb=wb.match(/safari/i)&&!wb.match(/chrome/i),Zb=wb.match(/opera/i),$b=wb.match(/(mobile|pre\/|xoom)/i)||Ub||Vb,_b=!xb.match(/usehtml5audio/i)&&!xb.match(/sm2\-ignorebadua/i)&&Yb&&!wb.match(/silk/i)&&wb.match(/OS X 10_6_([3-7])/i),ac=a.console!==b&&console.log!==b,bc=yb.hasFocus!==b?yb.hasFocus():null,cc=Yb&&(yb.hasFocus===b||!yb.hasFocus()),dc=!cc,ec=/(mp3|mp4|mpa|m4a|m4b)/i,fc=1e3,gc="about:blank",hc="data:audio/wave;base64,/UklGRiYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQIAAAD//w==",ic=yb.location?yb.location.protocol.match(/http/i):null,jc=ic?"":"http://",kc=/^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4||m4v|m4a|m4b|mp4v|3gp|3g2)\s*(?:$|;)/i,lc=["mpeg4","aac","flv","mov","mp4","m4v","f4v","m4a","m4b","mp4v","3gp","3g2"],mc=new RegExp("\\.("+lc.join("|")+")(\\?.*)?$","i");this.mimePattern=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i,this.useAltURL=!ic,R={swfBox:"sm2-object-box",swfDefault:"movieContainer",swfError:"swf_error",swfTimedout:"swf_timedout",swfLoaded:"swf_loaded",swfUnblocked:"swf_unblocked",sm2Debug:"sm2_debug",highPerf:"high_performance",flashDebug:"flash_debug"},this.hasHTML5=function(){try{return Audio!==b&&(Zb&&opera!==b&&opera.version()<10?new Audio(null):new Audio).canPlayType!==b}catch(a){return!1}}(),this.setup=function(a){var c=!qb.url;return a!==b&&Db&&Qb&&qb.ok()&&(a.flashVersion!==b||a.url!==b||a.html5Test!==b)&&V(O("setupLate")),q(a),a&&(c&&F&&a.url!==b&&qb.beginDelayedInit(),F||a.url===b||"complete"!==yb.readyState||setTimeout(D,1)),qb},this.ok=function(){return Qb?Db&&!Eb:qb.useHTML5Audio&&qb.hasHTML5},this.supported=this.ok,this.getMovie=function(b){return h(b)||yb[b]||a[b]},this.createSound=function(a,c){function d(){return h=T(h),qb.sounds[h.id]=new g(h),qb.soundIDs.push(h.id),qb.sounds[h.id]}var e,f,h,i=null;if(e=tb+".createSound(): ",f=e+O(Db?"notOK":"notReady"),!Db||!qb.ok())return V(f),!1;if(c!==b&&(a={id:a,url:c}),h=p(a),h.url=$(h.url),void 0===h.id&&(h.id=qb.setupOptions.idPrefix+Tb++),h.id.toString().charAt(0).match(/^[0-9]$/)&&qb._wD(e+O("badID",h.id),2),qb._wD(e+h.id+(h.url?" ("+h.url+")":""),1),W(h.id,!0))return qb._wD(e+h.id+" exists",1),qb.sounds[h.id];if(bb(h))i=d(),qb._wD(h.id+": Using HTML5"),i._setup_html5(h);else{if(qb.html5Only)return qb._wD(h.id+": No HTML5 support for this sound, and no Flash. Exiting."),d();if(qb.html5.usingFlash&&h.url&&h.url.match(/data\:/i))return qb._wD(h.id+": data: URIs not supported via Flash. Exiting."),d();l>8&&(null===h.isMovieStar&&(h.isMovieStar=!!(h.serverURL||(h.type?h.type.match(kc):!1)||h.url&&h.url.match(mc))),h.isMovieStar&&(qb._wD(e+"using MovieStar handling"),h.loops>1&&n("noNSLoop"))),h=U(h,e),i=d(),8===l?sb._createSound(h.id,h.loops||1,h.usePolicyFile):(sb._createSound(h.id,h.url,h.usePeakData,h.useWaveformData,h.useEQData,h.isMovieStar,h.isMovieStar?h.bufferTime:!1,h.loops||1,h.serverURL,h.duration||null,h.autoPlay,!0,h.autoLoad,h.usePolicyFile),h.serverURL||(i.connected=!0,h.onconnect&&h.onconnect.apply(i))),h.serverURL||!h.autoLoad&&!h.autoPlay||i.load(h)}return!h.serverURL&&h.autoPlay&&i.play(),i},this.destroySound=function(a,b){if(!W(a))return!1;var c,d=qb.sounds[a];for(d._iO={},d.stop(),d.unload(),c=0;c<qb.soundIDs.length;c++)if(qb.soundIDs[c]===a){qb.soundIDs.splice(c,1);break}return b||d.destruct(!0),d=null,delete qb.sounds[a],!0},this.load=function(a,b){return W(a)?qb.sounds[a].load(b):!1},this.unload=function(a){return W(a)?qb.sounds[a].unload():!1},this.onPosition=function(a,b,c,d){return W(a)?qb.sounds[a].onposition(b,c,d):!1},this.onposition=this.onPosition,this.clearOnPosition=function(a,b,c){return W(a)?qb.sounds[a].clearOnPosition(b,c):!1},this.play=function(a,b){var c=null,d=b&&!(b instanceof Object);if(!Db||!qb.ok())return V(tb+".play(): "+O(Db?"notOK":"notReady")),!1;if(W(a,d))d&&(b={url:b});else{if(!d)return!1;d&&(b={url:b}),b&&b.url&&(qb._wD(tb+'.play(): Attempting to create "'+a+'"',1),b.id=a,c=qb.createSound(b).play())}return null===c&&(c=qb.sounds[a].play(b)),c},this.start=this.play,this.setPosition=function(a,b){return W(a)?qb.sounds[a].setPosition(b):!1},this.stop=function(a){return W(a)?(qb._wD(tb+".stop("+a+")",1),qb.sounds[a].stop()):!1},this.stopAll=function(){var a;qb._wD(tb+".stopAll()",1);for(a in qb.sounds)qb.sounds.hasOwnProperty(a)&&qb.sounds[a].stop()},this.pause=function(a){return W(a)?qb.sounds[a].pause():!1},this.pauseAll=function(){var a;for(a=qb.soundIDs.length-1;a>=0;a--)qb.sounds[qb.soundIDs[a]].pause()},this.resume=function(a){return W(a)?qb.sounds[a].resume():!1},this.resumeAll=function(){var a;for(a=qb.soundIDs.length-1;a>=0;a--)qb.sounds[qb.soundIDs[a]].resume()},this.togglePause=function(a){return W(a)?qb.sounds[a].togglePause():!1},this.setPan=function(a,b){return W(a)?qb.sounds[a].setPan(b):!1},this.setVolume=function(a,b){return W(a)?qb.sounds[a].setVolume(b):!1},this.mute=function(a){var b=0;if(a instanceof String&&(a=null),a)return W(a)?(qb._wD(tb+'.mute(): Muting "'+a+'"'),qb.sounds[a].mute()):!1;for(qb._wD(tb+".mute(): Muting all sounds"),b=qb.soundIDs.length-1;b>=0;b--)qb.sounds[qb.soundIDs[b]].mute();return qb.muted=!0,!0},this.muteAll=function(){qb.mute()},this.unmute=function(a){var b;if(a instanceof String&&(a=null),a)return W(a)?(qb._wD(tb+'.unmute(): Unmuting "'+a+'"'),qb.sounds[a].unmute()):!1;for(qb._wD(tb+".unmute(): Unmuting all sounds"),b=qb.soundIDs.length-1;b>=0;b--)qb.sounds[qb.soundIDs[b]].unmute();return qb.muted=!1,!0},this.unmuteAll=function(){qb.unmute()},this.toggleMute=function(a){return W(a)?qb.sounds[a].toggleMute():!1},this.getMemoryUse=function(){var a=0;return sb&&8!==l&&(a=parseInt(sb._getMemoryUse(),10)),a},this.disable=function(c){var d;if(c===b&&(c=!1),Eb)return!1;for(Eb=!0,n("shutdown",1),d=qb.soundIDs.length-1;d>=0;d--)L(qb.sounds[qb.soundIDs[d]]);return o(c),hb.remove(a,"load",u),!0},this.canPlayMIME=function(a){var b;return qb.hasHTML5&&(b=cb({type:a})),!b&&Qb&&(b=a&&qb.ok()?!!((l>8?a.match(kc):null)||a.match(qb.mimePattern)):null),b},this.canPlayURL=function(a){var b;return qb.hasHTML5&&(b=cb({url:a})),!b&&Qb&&(b=a&&qb.ok()?!!a.match(qb.filePattern):null),b},this.canPlayLink=function(a){return a.type!==b&&a.type&&qb.canPlayMIME(a.type)?!0:qb.canPlayURL(a.href)},this.getSoundById=function(a,b){if(!a)return null;var c=qb.sounds[a];return c||b||qb._wD(tb+'.getSoundById(): Sound "'+a+'" not found.',2),c},this.onready=function(b,c){var d="onready",e=!1;if("function"!=typeof b)throw O("needFunction",d);return Db&&qb._wD(O("queue",d)),c||(c=a),s(d,b,c),t(),e=!0,e},this.ontimeout=function(b,c){var d="ontimeout",e=!1;if("function"!=typeof b)throw O("needFunction",d);return Db&&qb._wD(O("queue",d)),c||(c=a),s(d,b,c),t({type:d}),e=!0,e},this._writeDebug=function(a,c){var d,e,f="soundmanager-debug";return qb.debugMode?ac&&qb.useConsole&&(c&&"object"==typeof c?console.log(a,c):Hb[c]!==b?console[Hb[c]](a):console.log(a),qb.consoleOnly)?!0:(d=h(f))?(e=yb.createElement("div"),++Gb%2===0&&(e.className="sm2-alt"),c=c===b?0:parseInt(c,10),e.appendChild(yb.createTextNode(a)),c&&(c>=2&&(e.style.fontWeight="bold"),3===c&&(e.style.color="#ff3333")),d.insertBefore(e,d.firstChild),d=null,!0):!1:!1},-1!==xb.indexOf("sm2-debug=alert")&&(this._writeDebug=function(b){a.alert(b)}),this._wD=this._writeDebug,this._debug=function(){var a,b;for(n("currentObj",1),a=0,b=qb.soundIDs.length;b>a;a++)qb.sounds[qb.soundIDs[a]]._debug()},this.reboot=function(b,c){qb.soundIDs.length&&qb._wD("Destroying "+qb.soundIDs.length+" SMSound object"+(1!==qb.soundIDs.length?"s":"")+"...");var d,e,f;for(d=qb.soundIDs.length-1;d>=0;d--)qb.sounds[qb.soundIDs[d]].destruct();if(sb)try{Wb&&(Kb=sb.innerHTML),Jb=sb.parentNode.removeChild(sb)}catch(g){n("badRemove",2)}if(Kb=Jb=Qb=sb=null,qb.enabled=F=Db=Lb=Mb=Bb=Cb=Eb=Sb=qb.swfLoaded=!1,qb.soundIDs=[],qb.sounds={},Tb=0,b)zb=[];else for(d in zb)if(zb.hasOwnProperty(d))for(e=0,f=zb[d].length;f>e;e++)zb[d][e].fired=!1;return c||qb._wD(tb+": Rebooting..."),qb.html5={usingFlash:null},qb.flash={},qb.html5Only=!1,qb.ignoreFlash=!1,a.setTimeout(function(){C(),c||qb.beginDelayedInit()},20),qb},this.reset=function(){return n("reset"),qb.reboot(!0,!0)},this.getMoviePercent=function(){return sb&&"PercentLoaded"in sb?sb.PercentLoaded():null},this.beginDelayedInit=function(){Fb=!0,D(),setTimeout(function(){return Mb?!1:(H(),B(),Mb=!0,!0)},20),v()},this.destruct=function(){qb._wD(tb+".destruct()"),qb.disable(!0)},g=function(a){var c,d,e,f,g,h,i,j,k,o,q=this,r=!1,s=[],t=0,u=null;k={duration:null,time:null},this.id=a.id,this.sID=this.id,this.url=a.url,this.options=p(a),this.instanceOptions=this.options,this._iO=this.instanceOptions,this.pan=this.options.pan,this.volume=this.options.volume,this.isHTML5=!1,this._a=null,o=this.url?!1:!0,this.id3={},this._debug=function(){qb._wD(q.id+": Merged options:",q.options)},this.load=function(a){var c,d=null;if(a!==b?q._iO=p(a,q.options):(a=q.options,q._iO=a,u&&u!==q.url&&(n("manURL"),q._iO.url=q.url,q.url=null)),q._iO.url||(q._iO.url=q.url),q._iO.url=$(q._iO.url),q.instanceOptions=q._iO,c=q._iO,qb._wD(q.id+": load ("+c.url+")"),!c.url&&!q.url)return qb._wD(q.id+": load(): url is unassigned. Exiting.",2),q;if(q.isHTML5||8!==l||q.url||c.autoPlay||qb._wD(q.id+": Flash 8 load() limitation: Wait for onload() before calling play().",1),c.url===q.url&&0!==q.readyState&&2!==q.readyState)return n("onURL",1),3===q.readyState&&c.onload&&pb(q,function(){c.onload.apply(q,[!!q.duration])}),q;if(q.loaded=!1,q.readyState=1,q.playState=0,q.id3={},bb(c))d=q._setup_html5(c),d._called_load?qb._wD(q.id+": Ignoring request to load again"):(q._html5_canplay=!1,q.url!==c.url&&(qb._wD(n("manURL")+": "+c.url),q._a.src=c.url,q.setPosition(0)),q._a.autobuffer="auto",q._a.preload="auto",q._a._called_load=!0);else{if(qb.html5Only)return qb._wD(q.id+": No flash support. Exiting."),q;if(q._iO.url&&q._iO.url.match(/data\:/i))return qb._wD(q.id+": data: URIs not supported via Flash. Exiting."),q;try{q.isHTML5=!1,q._iO=U(T(c)),c=q._iO,8===l?sb._load(q.id,c.url,c.stream,c.autoPlay,c.usePolicyFile):sb._load(q.id,c.url,!!c.stream,!!c.autoPlay,c.loops||1,!!c.autoLoad,c.usePolicyFile)}catch(e){n("smError",2),m("onload",!1),I({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:!0})}}return q.url=c.url,q},this.unload=function(){return 0!==q.readyState&&(qb._wD(q.id+": unload()"),q.isHTML5?(f(),q._a&&(q._a.pause(),u=eb(q._a))):8===l?sb._unload(q.id,gc):sb._unload(q.id),c()),q},this.destruct=function(a){qb._wD(q.id+": Destruct"),q.isHTML5?(f(),q._a&&(q._a.pause(),eb(q._a),Sb||e(),q._a._s=null,q._a=null)):(q._iO.onfailure=null,sb._destroySound(q.id)),a||qb.destroySound(q.id,!0)},this.play=function(a,c){var d,e,f,i,k,m,n,s=!0,t=null;if(d=q.id+": play(): ",c=c===b?!0:c,a||(a={}),q.url&&(q._iO.url=q.url),q._iO=p(q._iO,q.options),q._iO=p(a,q._iO),q._iO.url=$(q._iO.url),q.instanceOptions=q._iO,!q.isHTML5&&q._iO.serverURL&&!q.connected)return q.getAutoPlay()||(qb._wD(d+" Netstream not connected yet - setting autoPlay"),q.setAutoPlay(!0)),q;if(bb(q._iO)&&(q._setup_html5(q._iO),g()),1!==q.playState||q.paused||(e=q._iO.multiShot,e?qb._wD(d+"Already playing (multi-shot)",1):(qb._wD(d+"Already playing (one-shot)",1),q.isHTML5&&q.setPosition(q._iO.position),t=q)),null!==t)return t;if(a.url&&a.url!==q.url&&(q.readyState||q.isHTML5||8!==l||!o?q.load(q._iO):o=!1),q.loaded?qb._wD(d.substr(0,d.lastIndexOf(":"))):0===q.readyState?(qb._wD(d+"Attempting to load"),q.isHTML5||qb.html5Only?q.isHTML5?q.load(q._iO):(qb._wD(d+"Unsupported type. Exiting."),t=q):(q._iO.autoPlay=!0,q.load(q._iO)),q.instanceOptions=q._iO):2===q.readyState?(qb._wD(d+"Could not load - exiting",2),t=q):qb._wD(d+"Loading - attempting to play..."),null!==t)return t;if(!q.isHTML5&&9===l&&q.position>0&&q.position===q.duration&&(qb._wD(d+"Sound at end, resetting to position:0"),a.position=0),q.paused&&q.position>=0&&(!q._iO.serverURL||q.position>0))qb._wD(d+"Resuming from paused state",1),q.resume();else{if(q._iO=p(a,q._iO),null!==q._iO.from&&null!==q._iO.to&&0===q.instanceCount&&0===q.playState&&!q._iO.serverURL){if(i=function(){q._iO=p(a,q._iO),q.play(q._iO)},q.isHTML5&&!q._html5_canplay?(qb._wD(d+"Beginning load for from/to case"),q.load({_oncanplay:i}),t=!1):q.isHTML5||q.loaded||q.readyState&&2===q.readyState||(qb._wD(d+"Preloading for from/to case"),q.load({onload:i}),t=!1),null!==t)return t;q._iO=j()}(!q.instanceCount||q._iO.multiShotEvents||q.isHTML5&&q._iO.multiShot&&!Sb||!q.isHTML5&&l>8&&!q.getAutoPlay())&&q.instanceCount++,q._iO.onposition&&0===q.playState&&h(q),q.playState=1,q.paused=!1,q.position=q._iO.position===b||isNaN(q._iO.position)?0:q._iO.position,q.isHTML5||(q._iO=U(T(q._iO))),q._iO.onplay&&c&&(q._iO.onplay.apply(q),r=!0),q.setVolume(q._iO.volume,!0),q.setPan(q._iO.pan,!0),q.isHTML5?q.instanceCount<2?(g(),f=q._setup_html5(),q.setPosition(q._iO.position),f.play()):(qb._wD(q.id+": Cloning Audio() for instance #"+q.instanceCount+"..."),k=new Audio(q._iO.url),m=function(){hb.remove(k,"ended",m),q._onfinish(q),eb(k),k=null},n=function(){hb.remove(k,"canplay",n);try{k.currentTime=q._iO.position/fc}catch(a){V(q.id+": multiShot play() failed to apply position of "+q._iO.position/fc)}k.play()},hb.add(k,"ended",m),void 0!==q._iO.volume&&(k.volume=Math.max(0,Math.min(1,q._iO.volume/100))),q.muted&&(k.muted=!0),q._iO.position?hb.add(k,"canplay",n):k.play()):(s=sb._start(q.id,q._iO.loops||1,9===l?q.position:q.position/fc,q._iO.multiShot||!1),9!==l||s||(qb._wD(d+"No sound hardware, or 32-sound ceiling hit",2),q._iO.onplayerror&&q._iO.onplayerror.apply(q)))}return q},this.start=this.play,this.stop=function(a){var b,c=q._iO;return 1===q.playState&&(qb._wD(q.id+": stop()"),q._onbufferchange(0),q._resetOnPosition(0),q.paused=!1,q.isHTML5||(q.playState=0),i(),c.to&&q.clearOnPosition(c.to),q.isHTML5?q._a&&(b=q.position,q.setPosition(0),q.position=b,q._a.pause(),q.playState=0,q._onTimer(),f()):(sb._stop(q.id,a),c.serverURL&&q.unload()),q.instanceCount=0,q._iO={},c.onstop&&c.onstop.apply(q)),q},this.setAutoPlay=function(a){qb._wD(q.id+": Autoplay turned "+(a?"on":"off")),q._iO.autoPlay=a,q.isHTML5||(sb._setAutoPlay(q.id,a),a&&(q.instanceCount||1!==q.readyState||(q.instanceCount++,qb._wD(q.id+": Incremented instance count to "+q.instanceCount))))},this.getAutoPlay=function(){return q._iO.autoPlay},this.setPosition=function(a){a===b&&(a=0);var c,d,e=q.isHTML5?Math.max(a,0):Math.min(q.duration||q._iO.duration,Math.max(a,0));if(q.position=e,d=q.position/fc,q._resetOnPosition(q.position),q._iO.position=e,q.isHTML5){if(q._a){if(q._html5_canplay){if(q._a.currentTime!==d){qb._wD(q.id+": setPosition("+d+")");try{q._a.currentTime=d,(0===q.playState||q.paused)&&q._a.pause()}catch(f){qb._wD(q.id+": setPosition("+d+") failed: "+f.message,2)}}}else if(d)return qb._wD(q.id+": setPosition("+d+"): Cannot seek yet, sound not ready",2),q;q.paused&&q._onTimer(!0)}}else c=9===l?q.position:d,q.readyState&&2!==q.readyState&&sb._setPosition(q.id,c,q.paused||!q.playState,q._iO.multiShot);return q},this.pause=function(a){return q.paused||0===q.playState&&1!==q.readyState?q:(qb._wD(q.id+": pause()"),q.paused=!0,q.isHTML5?(q._setup_html5().pause(),f()):(a||a===b)&&sb._pause(q.id,q._iO.multiShot),q._iO.onpause&&q._iO.onpause.apply(q),q)},this.resume=function(){var a=q._iO;return q.paused?(qb._wD(q.id+": resume()"),q.paused=!1,q.playState=1,q.isHTML5?(q._setup_html5().play(),g()):(a.isMovieStar&&!a.serverURL&&q.setPosition(q.position),sb._pause(q.id,a.multiShot)),!r&&a.onplay?(a.onplay.apply(q),r=!0):a.onresume&&a.onresume.apply(q),q):q},this.togglePause=function(){return qb._wD(q.id+": togglePause()"),0===q.playState?(q.play({position:9!==l||q.isHTML5?q.position/fc:q.position}),q):(q.paused?q.resume():q.pause(),q)},this.setPan=function(a,c){return a===b&&(a=0),c===b&&(c=!1),q.isHTML5||sb._setPan(q.id,a),q._iO.pan=a,c||(q.pan=a,q.options.pan=a),q},this.setVolume=function(a,c){return a===b&&(a=100),c===b&&(c=!1),q.isHTML5?q._a&&(qb.muted&&!q.muted&&(q.muted=!0,q._a.muted=!0),q._a.volume=Math.max(0,Math.min(1,a/100))):sb._setVolume(q.id,qb.muted&&!q.muted||q.muted?0:a),q._iO.volume=a,c||(q.volume=a,q.options.volume=a),q},this.mute=function(){return q.muted=!0,q.isHTML5?q._a&&(q._a.muted=!0):sb._setVolume(q.id,0),q},this.unmute=function(){q.muted=!1;var a=q._iO.volume!==b;return q.isHTML5?q._a&&(q._a.muted=!1):sb._setVolume(q.id,a?q._iO.volume:q.options.volume),q},this.toggleMute=function(){return q.muted?q.unmute():q.mute()},this.onPosition=function(a,c,d){return s.push({position:parseInt(a,10),method:c,scope:d!==b?d:q,fired:!1}),q},this.onposition=this.onPosition,this.clearOnPosition=function(a,b){var c;if(a=parseInt(a,10),isNaN(a))return!1;for(c=0;c<s.length;c++)a===s[c].position&&(b&&b!==s[c].method||(s[c].fired&&t--,s.splice(c,1)))},this._processOnPosition=function(){var a,b,c=s.length;if(!c||!q.playState||t>=c)return!1;for(a=c-1;a>=0;a--)b=s[a],!b.fired&&q.position>=b.position&&(b.fired=!0,t++,b.method.apply(b.scope,[b.position]),c=s.length);return!0},this._resetOnPosition=function(a){var b,c,d=s.length;if(!d)return!1;for(b=d-1;b>=0;b--)c=s[b],c.fired&&a<=c.position&&(c.fired=!1,t--);return!0},j=function(){var a,b,c=q._iO,d=c.from,e=c.to;return b=function(){qb._wD(q.id+': "To" time of '+e+" reached."),q.clearOnPosition(e,b),q.stop()},a=function(){qb._wD(q.id+': Playing "from" '+d),null===e||isNaN(e)||q.onPosition(e,b)},null===d||isNaN(d)||(c.position=d,c.multiShot=!1,a()),c},h=function(){var a,b=q._iO.onposition;if(b)for(a in b)b.hasOwnProperty(a)&&q.onPosition(parseInt(a,10),b[a])},i=function(){var a,b=q._iO.onposition;if(b)for(a in b)b.hasOwnProperty(a)&&q.clearOnPosition(parseInt(a,10))},g=function(){q.isHTML5&&X(q)},f=function(){q.isHTML5&&Y(q)},c=function(a){a||(s=[],t=0),r=!1,q._hasTimer=null,q._a=null,q._html5_canplay=!1,q.bytesLoaded=null,q.bytesTotal=null,q.duration=q._iO&&q._iO.duration?q._iO.duration:null,q.durationEstimate=null,q.buffered=[],q.eqData=[],q.eqData.left=[],q.eqData.right=[],q.failures=0,q.isBuffering=!1,q.instanceOptions={},q.instanceCount=0,q.loaded=!1,q.metadata={},q.readyState=0,q.muted=!1,q.paused=!1,q.peakData={left:0,right:0},q.waveformData={left:[],right:[]},q.playState=0,q.position=null,q.id3={}},c(),this._onTimer=function(a){var b,c,d=!1,e={};return q._hasTimer||a?(q._a&&(a||(q.playState>0||1===q.readyState)&&!q.paused)&&(b=q._get_html5_duration(),b!==k.duration&&(k.duration=b,q.duration=b,d=!0),q.durationEstimate=q.duration,c=q._a.currentTime*fc||0,c!==k.time&&(k.time=c,d=!0),(d||a)&&q._whileplaying(c,e,e,e,e)),d):void 0},this._get_html5_duration=function(){var a=q._iO,b=q._a&&q._a.duration?q._a.duration*fc:a&&a.duration?a.duration:null,c=b&&!isNaN(b)&&1/0!==b?b:null;return c},this._apply_loop=function(a,b){!a.loop&&b>1&&qb._wD("Note: Native HTML5 looping is infinite.",1),a.loop=b>1?"loop":""},this._setup_html5=function(a){var b,e=p(q._iO,a),f=Sb?rb:q._a,g=decodeURI(e.url);if(Sb?g===decodeURI(ib)&&(b=!0):g===decodeURI(u)&&(b=!0),f){if(f._s)if(Sb)f._s&&f._s.playState&&!b&&f._s.stop();else if(!Sb&&g===decodeURI(u))return q._apply_loop(f,e.loops),f;b||(u&&c(!1),f.src=e.url,q.url=e.url,u=e.url,ib=e.url,f._called_load=!1)}else e.autoLoad||e.autoPlay?(q._a=new Audio(e.url),q._a.load()):q._a=Zb&&opera.version()<10?new Audio(null):new Audio,f=q._a,f._called_load=!1,Sb&&(rb=f);return q.isHTML5=!0,q._a=f,f._s=q,d(),q._apply_loop(f,e.loops),e.autoLoad||e.autoPlay?q.load():(f.autobuffer=!1,f.preload="auto"),f},d=function(){function a(a,b,c){return q._a?q._a.addEventListener(a,b,c||!1):null}if(q._a._added_events)return!1;var b;q._a._added_events=!0;for(b in mb)mb.hasOwnProperty(b)&&a(b,mb[b]);return!0},e=function(){function a(a,b,c){return q._a?q._a.removeEventListener(a,b,c||!1):null}var b;qb._wD(q.id+": Removing event listeners"),q._a._added_events=!1;for(b in mb)mb.hasOwnProperty(b)&&a(b,mb[b])},this._onload=function(a){var b,c=!!a||!q.isHTML5&&8===l&&q.duration;return b=q.id+": ",qb._wD(b+(c?"onload()":"Failed to load / invalid sound?"+(q.duration?" -":" Zero-length duration reported.")+" ("+q.url+")"),c?1:2),c||q.isHTML5||(qb.sandbox.noRemote===!0&&qb._wD(b+O("noNet"),1),qb.sandbox.noLocal===!0&&qb._wD(b+O("noLocal"),1)),q.loaded=c,q.readyState=c?3:2,q._onbufferchange(0),q._iO.onload&&pb(q,function(){q._iO.onload.apply(q,[c])}),!0},this._onbufferchange=function(a){return 0===q.playState?!1:a&&q.isBuffering||!a&&!q.isBuffering?!1:(q.isBuffering=1===a,q._iO.onbufferchange&&(qb._wD(q.id+": Buffer state change: "+a),q._iO.onbufferchange.apply(q)),!0)},this._onsuspend=function(){return q._iO.onsuspend&&(qb._wD(q.id+": Playback suspended"),q._iO.onsuspend.apply(q)),!0},this._onfailure=function(a,b,c){q.failures++,qb._wD(q.id+": Failures = "+q.failures),q._iO.onfailure&&1===q.failures?q._iO.onfailure(q,a,b,c):qb._wD(q.id+": Ignoring failure")},this._onfinish=function(){var a=q._iO.onfinish;q._onbufferchange(0),q._resetOnPosition(0),q.instanceCount&&(q.instanceCount--,q.instanceCount||(i(),q.playState=0,q.paused=!1,q.instanceCount=0,q.instanceOptions={},q._iO={},f(),q.isHTML5&&(q.position=0)),(!q.instanceCount||q._iO.multiShotEvents)&&a&&(qb._wD(q.id+": onfinish()"),pb(q,function(){a.apply(q)})))},this._whileloading=function(a,b,c,d){var e=q._iO;q.bytesLoaded=a,q.bytesTotal=b,q.duration=Math.floor(c),q.bufferLength=d,q.durationEstimate=q.isHTML5||e.isMovieStar?q.duration:e.duration?q.duration>e.duration?q.duration:e.duration:parseInt(q.bytesTotal/q.bytesLoaded*q.duration,10),q.isHTML5||(q.buffered=[{start:0,end:q.duration}]),(3!==q.readyState||q.isHTML5)&&e.whileloading&&e.whileloading.apply(q)},this._whileplaying=function(a,c,d,e,f){var g,h=q._iO;return isNaN(a)||null===a?!1:(q.position=Math.max(0,a),q._processOnPosition(),!q.isHTML5&&l>8&&(h.usePeakData&&c!==b&&c&&(q.peakData={left:c.leftPeak,right:c.rightPeak}),h.useWaveformData&&d!==b&&d&&(q.waveformData={left:d.split(","),right:e.split(",")}),h.useEQData&&f!==b&&f&&f.leftEQ&&(g=f.leftEQ.split(","),q.eqData=g,q.eqData.left=g,f.rightEQ!==b&&f.rightEQ&&(q.eqData.right=f.rightEQ.split(",")))),1===q.playState&&(q.isHTML5||8!==l||q.position||!q.isBuffering||q._onbufferchange(0),h.whileplaying&&h.whileplaying.apply(q)),!0)},this._oncaptiondata=function(a){qb._wD(q.id+": Caption data received."),q.captiondata=a,q._iO.oncaptiondata&&q._iO.oncaptiondata.apply(q,[a])},this._onmetadata=function(a,b){qb._wD(q.id+": Metadata received.");var c,d,e={};for(c=0,d=a.length;d>c;c++)e[a[c]]=b[c];q.metadata=e,q._iO.onmetadata&&q._iO.onmetadata.apply(q)},this._onid3=function(a,b){qb._wD(q.id+": ID3 data received.");var c,d,e=[];for(c=0,d=a.length;d>c;c++)e[a[c]]=b[c];q.id3=p(q.id3,e),q._iO.onid3&&q._iO.onid3.apply(q)},this._onconnect=function(a){a=1===a,qb._wD(q.id+": "+(a?"Connected.":"Failed to connect? - "+q.url),a?1:2),q.connected=a,a&&(q.failures=0,W(q.id)&&(q.getAutoPlay()?q.play(b,q.getAutoPlay()):q._iO.autoLoad&&q.load()),q._iO.onconnect&&q._iO.onconnect.apply(q,[a]))},this._ondataerror=function(a){q.playState>0&&(qb._wD(q.id+": Data error: "+a),q._iO.ondataerror&&q._iO.ondataerror.apply(q))},this._debug()},G=function(){return yb.body||yb.getElementsByTagName("div")[0]},h=function(a){return yb.getElementById(a)},p=function(a,c){var d,e,f=a||{};d=c===b?qb.defaultOptions:c;for(e in d)d.hasOwnProperty(e)&&f[e]===b&&(f[e]="object"!=typeof d[e]||null===d[e]?d[e]:p(f[e],d[e]));return f},pb=function(b,c){b.isHTML5||8!==l?c():a.setTimeout(c,0)},r={onready:1,ontimeout:1,defaultOptions:1,flash9Options:1,movieStarOptions:1},q=function(a,c){var d,e=!0,f=c!==b,g=qb.setupOptions,h=r;if(a===b){e=[];for(d in g)g.hasOwnProperty(d)&&e.push(d);for(d in h)h.hasOwnProperty(d)&&e.push("object"==typeof qb[d]?d+": {...}":qb[d]instanceof Function?d+": function() {...}":d);return qb._wD(O("setup",e.join(", "))),!1}for(d in a)if(a.hasOwnProperty(d))if("object"!=typeof a[d]||null===a[d]||a[d]instanceof Array||a[d]instanceof RegExp)f&&h[c]!==b?qb[c][d]=a[d]:g[d]!==b?(qb.setupOptions[d]=a[d],qb[d]=a[d]):h[d]===b?(V(O(qb[d]===b?"setupUndef":"setupError",d),2),e=!1):qb[d]instanceof Function?qb[d].apply(qb,a[d]instanceof Array?a[d]:[a[d]]):qb[d]=a[d];else{if(h[d]!==b)return q(a[d],d);V(O(qb[d]===b?"setupUndef":"setupError",d),2),e=!1}return e},hb=function(){function b(a){var b=Rb.call(a),c=b.length;return f?(b[1]="on"+b[1],c>3&&b.pop()):3===c&&b.push(!1),b}function c(a,b){var c=a.shift(),d=[g[b]];f?c[d](a[0],a[1]):c[d].apply(c,a)}function d(){c(b(arguments),"add")}function e(){c(b(arguments),"remove")}var f=a.attachEvent,g={add:f?"attachEvent":"addEventListener",remove:f?"detachEvent":"removeEventListener"};return{add:d,remove:e}}(),mb={abort:f(function(){qb._wD(this._s.id+": abort")}),canplay:f(function(){var a,c=this._s;if(c._html5_canplay)return!0;if(c._html5_canplay=!0,qb._wD(c.id+": canplay"),c._onbufferchange(0),a=c._iO.position===b||isNaN(c._iO.position)?null:c._iO.position/fc,c.position&&this.currentTime!==a){qb._wD(c.id+": canplay: Setting position to "+a);try{this.currentTime=a}catch(d){qb._wD(c.id+": canplay: Setting position of "+a+" failed: "+d.message,2)}}c._iO._oncanplay&&c._iO._oncanplay()}),canplaythrough:f(function(){var a=this._s;a.loaded||(a._onbufferchange(0),a._whileloading(a.bytesLoaded,a.bytesTotal,a._get_html5_duration()),a._onload(!0))}),ended:f(function(){var a=this._s;qb._wD(a.id+": ended"),a._onfinish()}),error:f(function(){qb._wD(this._s.id+": HTML5 error, code "+this.error.code),this._s._onload(!1)}),loadeddata:f(function(){var a=this._s;qb._wD(a.id+": loadeddata"),a._loaded||Yb||(a.duration=a._get_html5_duration())}),loadedmetadata:f(function(){qb._wD(this._s.id+": loadedmetadata")}),loadstart:f(function(){qb._wD(this._s.id+": loadstart"),this._s._onbufferchange(1)}),play:f(function(){this._s._onbufferchange(0)}),playing:f(function(){qb._wD(this._s.id+": playing"),this._s._onbufferchange(0)}),progress:f(function(a){var b,c,d,e=this._s,f=0,g="progress"===a.type,h=a.target.buffered,i=a.loaded||0,j=a.total||1;if(e.buffered=[],h&&h.length){for(b=0,c=h.length;c>b;b++)e.buffered.push({start:h.start(b)*fc,end:h.end(b)*fc});if(f=(h.end(0)-h.start(0))*fc,i=Math.min(1,f/(a.target.duration*fc)),g&&h.length>1){for(d=[],c=h.length,b=0;c>b;b++)d.push(a.target.buffered.start(b)*fc+"-"+a.target.buffered.end(b)*fc);qb._wD(this._s.id+": progress, timeRanges: "+d.join(", "))}g&&!isNaN(i)&&qb._wD(this._s.id+": progress, "+Math.floor(100*i)+"% loaded")}isNaN(i)||(e._onbufferchange(0),e._whileloading(i,j,e._get_html5_duration()),i&&j&&i===j&&mb.canplaythrough.call(this,a))}),ratechange:f(function(){qb._wD(this._s.id+": ratechange")}),suspend:f(function(a){var b=this._s;qb._wD(this._s.id+": suspend"),mb.progress.call(this,a),b._onsuspend()}),stalled:f(function(){qb._wD(this._s.id+": stalled")}),timeupdate:f(function(){this._s._onTimer()}),waiting:f(function(){var a=this._s;qb._wD(this._s.id+": waiting"),a._onbufferchange(1)})},bb=function(a){var b;return b=a&&(a.type||a.url||a.serverURL)?a.serverURL||a.type&&e(a.type)?!1:a.type?cb({type:a.type}):cb({url:a.url})||qb.html5Only||a.url.match(/data\:/i):!1},eb=function(a){var b;return a&&(b=Yb?gc:qb.html5.canPlayType("audio/wav")?hc:gc,a.src=b,void 0!==a._called_unload&&(a._called_load=!1)),Sb&&(ib=null),b},cb=function(a){if(!qb.useHTML5Audio||!qb.hasHTML5)return!1;var c,d,f,g,h=a.url||null,i=a.type||null,j=qb.audioFormats;if(i&&qb.html5[i]!==b)return qb.html5[i]&&!e(i);if(!db){db=[];for(g in j)j.hasOwnProperty(g)&&(db.push(g),j[g].related&&(db=db.concat(j[g].related)));db=new RegExp("\\.("+db.join("|")+")(\\?.*)?$","i")}return f=h?h.toLowerCase().match(db):null,f&&f.length?f=f[1]:i?(d=i.indexOf(";"),f=(-1!==d?i.substr(0,d):i).substr(6)):c=!1,f&&qb.html5[f]!==b?c=qb.html5[f]&&!e(f):(i="audio/"+f,c=qb.html5.canPlayType({type:i}),qb.html5[f]=c,c=c&&qb.html5[i]&&!e(i)),c},gb=function(){function a(a){var b,c,d=!1,e=!1;if(!g||"function"!=typeof g.canPlayType)return d;if(a instanceof Array){for(f=0,c=a.length;c>f;f++)(qb.html5[a[f]]||g.canPlayType(a[f]).match(qb.html5Test))&&(e=!0,qb.html5[a[f]]=!0,qb.flash[a[f]]=!!a[f].match(ec));d=e}else b=g&&"function"==typeof g.canPlayType?g.canPlayType(a):!1,d=!(!b||!b.match(qb.html5Test));return d}if(!qb.useHTML5Audio||!qb.hasHTML5)return qb.html5.usingFlash=!0,Qb=!0,!1;var c,d,e,f,g=Audio!==b?Zb&&opera.version()<10?new Audio(null):new Audio:null,h={};e=qb.audioFormats;for(c in e)if(e.hasOwnProperty(c)&&(d="audio/"+c,h[c]=a(e[c].type),h[d]=h[c],c.match(ec)?(qb.flash[c]=!0,qb.flash[d]=!0):(qb.flash[c]=!1,qb.flash[d]=!1),e[c]&&e[c].related))for(f=e[c].related.length-1;f>=0;f--)h["audio/"+e[c].related[f]]=h[c],qb.html5[e[c].related[f]]=h[c],qb.flash[e[c].related[f]]=h[c];return h.canPlayType=g?a:null,qb.html5=p(qb.html5,h),qb.html5.usingFlash=ab(),Qb=qb.html5.usingFlash,!0},A={notReady:"Unavailable - wait until onready() has fired.",notOK:"Audio support is not available.",domError:tb+"exception caught while appending SWF to DOM.",spcWmode:"Removing wmode, preventing known SWF loading issue(s)",swf404:ub+"Verify that %s is a valid path.",tryDebug:"Try "+tb+".debugFlash = true for more security details (output goes to SWF.)",checkSWF:"See SWF output for more debug info.",localFail:ub+"Non-HTTP page ("+yb.location.protocol+" URL?) Review Flash player security settings for this special case:\nhttp://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\nMay need to add/allow path, eg. c:/sm2/ or /users/me/sm2/",waitFocus:ub+"Special case: Waiting for SWF to load with window focus...",waitForever:ub+"Waiting indefinitely for Flash (will recover if unblocked)...",waitSWF:ub+"Waiting for 100% SWF load...",needFunction:ub+"Function object expected for %s",badID:'Sound ID "%s" should be a string, starting with a non-numeric character',currentObj:ub+"_debug(): Current sound objects",waitOnload:ub+"Waiting for window.onload()",docLoaded:ub+"Document already loaded",onload:ub+"initComplete(): calling soundManager.onload()",onloadOK:tb+".onload() complete",didInit:ub+"init(): Already called?",secNote:"Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html",badRemove:ub+"Failed to remove Flash node.",shutdown:tb+".disable(): Shutting down",queue:ub+"Queueing %s handler",smError:"SMSound.load(): Exception: JS-Flash communication failed, or JS error.",fbTimeout:"No flash response, applying ."+R.swfTimedout+" CSS...",fbLoaded:"Flash loaded",fbHandler:ub+"flashBlockHandler()",manURL:"SMSound.load(): Using manually-assigned URL",onURL:tb+".load(): current URL already assigned.",badFV:tb+'.flashVersion must be 8 or 9. "%s" is invalid. Reverting to %s.',as2loop:"Note: Setting stream:false so looping can work (flash 8 limitation)",noNSLoop:"Note: Looping not implemented for MovieStar formats",needfl9:"Note: Switching to flash 9, required for MP4 formats.",mfTimeout:"Setting flashLoadTimeout = 0 (infinite) for off-screen, mobile flash case",needFlash:ub+"Fatal error: Flash is needed to play some required formats, but is not available.",gotFocus:ub+"Got window focus.",policy:"Enabling usePolicyFile for data access",setup:tb+".setup(): allowed parameters: %s",setupError:tb+'.setup(): "%s" cannot be assigned with this method.',setupUndef:tb+'.setup(): Could not find option "%s"',setupLate:tb+".setup(): url, flashVersion and html5Test property changes will not take effect until reboot().",noURL:ub+"Flash URL required. Call soundManager.setup({url:...}) to get started.",sm2Loaded:"SoundManager 2: Ready.",reset:tb+".reset(): Removing event callbacks",mobileUA:"Mobile UA detected, preferring HTML5 by default.",globalHTML5:"Using singleton HTML5 Audio() pattern for this device."},O=function(){var a,b,c,d,e;
if(a=Rb.call(arguments),d=a.shift(),e=A&&A[d]?A[d]:"",e&&a&&a.length)for(b=0,c=a.length;c>b;b++)e=e.replace("%s",a[b]);return e},T=function(a){return 8===l&&a.loops>1&&a.stream&&(n("as2loop"),a.stream=!1),a},U=function(a,b){return a&&!a.usePolicyFile&&(a.onid3||a.usePeakData||a.useWaveformData||a.useEQData)&&(qb._wD((b||"")+O("policy")),a.usePolicyFile=!0),a},V=function(a){ac&&console.warn!==b?console.warn(a):qb._wD(a)},i=function(){return!1},L=function(a){var b;for(b in a)a.hasOwnProperty(b)&&"function"==typeof a[b]&&(a[b]=i);b=null},M=function(a){a===b&&(a=!1),(Eb||a)&&qb.disable(a)},N=function(a){var b,c=null;if(a)if(a.match(/\.swf(\?.*)?$/i)){if(c=a.substr(a.toLowerCase().lastIndexOf(".swf?")+4))return a}else a.lastIndexOf("/")!==a.length-1&&(a+="/");return b=(a&&-1!==a.lastIndexOf("/")?a.substr(0,a.lastIndexOf("/")+1):"./")+qb.movieURL,qb.noSWFCache&&(b+="?ts="+(new Date).getTime()),b},y=function(){l=parseInt(qb.flashVersion,10),8!==l&&9!==l&&(qb._wD(O("badFV",l,Ib)),qb.flashVersion=l=Ib);var a=qb.debugMode||qb.debugFlash?"_debug.swf":".swf";qb.useHTML5Audio&&!qb.html5Only&&qb.audioFormats.mp4.required&&9>l&&(qb._wD(O("needfl9")),qb.flashVersion=l=9),qb.version=qb.versionNumber+(qb.html5Only?" (HTML5-only mode)":9===l?" (AS3/Flash 9)":" (AS2/Flash 8)"),l>8?(qb.defaultOptions=p(qb.defaultOptions,qb.flash9Options),qb.features.buffering=!0,qb.defaultOptions=p(qb.defaultOptions,qb.movieStarOptions),qb.filePatterns.flash9=new RegExp("\\.(mp3|"+lc.join("|")+")(\\?.*)?$","i"),qb.features.movieStar=!0):qb.features.movieStar=!1,qb.filePattern=qb.filePatterns[8!==l?"flash9":"flash8"],qb.movieURL=(8===l?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",a),qb.features.peakData=qb.features.waveformData=qb.features.eqData=l>8},J=function(a,b){return sb?void sb._setPolling(a,b):!1},K=function(){if(qb.debugURLParam.test(xb)&&(qb.debugMode=!0),h(qb.debugID))return!1;var a,b,c,d,e;if(!(!qb.debugMode||h(qb.debugID)||ac&&qb.useConsole&&qb.consoleOnly)){a=yb.createElement("div"),a.id=qb.debugID+"-toggle",d={position:"fixed",bottom:"0px",right:"0px",width:"1.2em",height:"1.2em",lineHeight:"1.2em",margin:"2px",textAlign:"center",border:"1px solid #999",cursor:"pointer",background:"#fff",color:"#333",zIndex:10001},a.appendChild(yb.createTextNode("-")),a.onclick=S,a.title="Toggle SM2 debug console",wb.match(/msie 6/i)&&(a.style.position="absolute",a.style.cursor="hand");for(e in d)d.hasOwnProperty(e)&&(a.style[e]=d[e]);if(b=yb.createElement("div"),b.id=qb.debugID,b.style.display=qb.debugMode?"block":"none",qb.debugMode&&!h(a.id)){try{c=G(),c.appendChild(a)}catch(f){throw new Error(O("domError")+" \n"+f.toString())}c.appendChild(b)}}c=null},W=this.getSoundById,n=function(a,b){return a?qb._wD(O(a),b):""},S=function(){var a=h(qb.debugID),b=h(qb.debugID+"-toggle");return a?(Ab?(b.innerHTML="+",a.style.display="none"):(b.innerHTML="-",a.style.display="block"),void(Ab=!Ab)):!1},m=function(c,d,e){if(a.sm2Debugger!==b)try{sm2Debugger.handleEvent(c,d,e)}catch(f){return!1}return!0},Q=function(){var a=[];return qb.debugMode&&a.push(R.sm2Debug),qb.debugFlash&&a.push(R.flashDebug),qb.useHighPerformance&&a.push(R.highPerf),a.join(" ")},P=function(){var a=O("fbHandler"),b=qb.getMoviePercent(),c=R,d={type:"FLASHBLOCK"};return qb.html5Only?!1:void(qb.ok()?(qb.didFlashBlock&&qb._wD(a+": Unblocked"),qb.oMC&&(qb.oMC.className=[Q(),c.swfDefault,c.swfLoaded+(qb.didFlashBlock?" "+c.swfUnblocked:"")].join(" "))):(Qb&&(qb.oMC.className=Q()+" "+c.swfDefault+" "+(null===b?c.swfTimedout:c.swfError),qb._wD(a+": "+O("fbTimeout")+(b?" ("+O("fbLoaded")+")":""))),qb.didFlashBlock=!0,t({type:"ontimeout",ignoreInit:!0,error:d}),I(d)))},s=function(a,c,d){zb[a]===b&&(zb[a]=[]),zb[a].push({method:c,scope:d||null,fired:!1})},t=function(a){if(a||(a={type:qb.ok()?"onready":"ontimeout"}),!Db&&a&&!a.ignoreInit)return!1;if("ontimeout"===a.type&&(qb.ok()||Eb&&!a.ignoreInit))return!1;var b,c,d={success:a&&a.ignoreInit?qb.ok():!Eb},e=a&&a.type?zb[a.type]||[]:[],f=[],g=[d],h=Qb&&!qb.ok();for(a.error&&(g[0].error=a.error),b=0,c=e.length;c>b;b++)e[b].fired!==!0&&f.push(e[b]);if(f.length)for(b=0,c=f.length;c>b;b++)f[b].scope?f[b].method.apply(f[b].scope,g):f[b].method.apply(this,g),h||(f[b].fired=!0);return!0},u=function(){a.setTimeout(function(){qb.useFlashBlock&&P(),t(),"function"==typeof qb.onload&&(n("onload",1),qb.onload.apply(a),n("onloadOK",1)),qb.waitForWindowLoad&&hb.add(a,"load",u)},1)},kb=function(){if(jb!==b)return jb;var c,d,e,f=!1,g=navigator,h=g.plugins,i=a.ActiveXObject;if(h&&h.length)d="application/x-shockwave-flash",e=g.mimeTypes,e&&e[d]&&e[d].enabledPlugin&&e[d].enabledPlugin.description&&(f=!0);else if(i!==b&&!wb.match(/MSAppHost/i)){try{c=new i("ShockwaveFlash.ShockwaveFlash")}catch(j){c=null}f=!!c,c=null}return jb=f,f},ab=function(){var a,b,c=qb.audioFormats,d=Ub&&!!wb.match(/os (1|2|3_0|3_1)/i);if(d?(qb.hasHTML5=!1,qb.html5Only=!0,qb.oMC&&(qb.oMC.style.display="none")):qb.useHTML5Audio&&(qb.html5&&qb.html5.canPlayType||(qb._wD("SoundManager: No HTML5 Audio() support detected."),qb.hasHTML5=!1),_b&&qb._wD(ub+"Note: Buggy HTML5 Audio in Safari on this OS X release, see https://bugs.webkit.org/show_bug.cgi?id=32159 - "+(jb?"will use flash fallback for MP3/MP4, if available":" would use flash fallback for MP3/MP4, but none detected."),1)),qb.useHTML5Audio&&qb.hasHTML5){_=!0;for(b in c)c.hasOwnProperty(b)&&c[b].required&&(qb.html5.canPlayType(c[b].type)?qb.preferFlash&&(qb.flash[b]||qb.flash[c[b].type])&&(a=!0):(_=!1,a=!0))}return qb.ignoreFlash&&(a=!1,_=!0),qb.html5Only=qb.hasHTML5&&qb.useHTML5Audio&&!a,!qb.html5Only},$=function(a){var b,c,d,e=0;if(a instanceof Array){for(b=0,c=a.length;c>b;b++)if(a[b]instanceof Object){if(qb.canPlayMIME(a[b].type)){e=b;break}}else if(qb.canPlayURL(a[b])){e=b;break}a[e].url&&(a[e]=a[e].url),d=a[e]}else d=a;return d},X=function(a){a._hasTimer||(a._hasTimer=!0,!$b&&qb.html5PollingInterval&&(null===Ob&&0===Nb&&(Ob=setInterval(Z,qb.html5PollingInterval)),Nb++))},Y=function(a){a._hasTimer&&(a._hasTimer=!1,!$b&&qb.html5PollingInterval&&Nb--)},Z=function(){var a;if(null!==Ob&&!Nb)return clearInterval(Ob),Ob=null,!1;for(a=qb.soundIDs.length-1;a>=0;a--)qb.sounds[qb.soundIDs[a]].isHTML5&&qb.sounds[qb.soundIDs[a]]._hasTimer&&qb.sounds[qb.soundIDs[a]]._onTimer()},I=function(c){c=c!==b?c:{},"function"==typeof qb.onerror&&qb.onerror.apply(a,[{type:c.type!==b?c.type:null}]),c.fatal!==b&&c.fatal&&qb.disable()},lb=function(){if(!_b||!kb())return!1;var a,b,c=qb.audioFormats;for(b in c)if(c.hasOwnProperty(b)&&("mp3"===b||"mp4"===b)&&(qb._wD(tb+": Using flash fallback for "+b+" format"),qb.html5[b]=!1,c[b]&&c[b].related))for(a=c[b].related.length-1;a>=0;a--)qb.html5[c[b].related[a]]=!1},this._setSandboxType=function(a){var c=qb.sandbox;c.type=a,c.description=c.types[c.types[a]!==b?a:"unknown"],"localWithFile"===c.type?(c.noRemote=!0,c.noLocal=!1,n("secNote",2)):"localWithNetwork"===c.type?(c.noRemote=!1,c.noLocal=!0):"localTrusted"===c.type&&(c.noRemote=!1,c.noLocal=!1)},this._externalInterfaceOK=function(a){if(qb.swfLoaded)return!1;var b;return m("swf",!0),m("flashtojs",!0),qb.swfLoaded=!0,cc=!1,_b&&lb(),a&&a.replace(/\+dev/i,"")===qb.versionNumber.replace(/\+dev/i,"")?void setTimeout(k,Wb?100:1):(b=tb+': Fatal: JavaScript file build "'+qb.versionNumber+'" does not match Flash SWF build "'+a+'" at '+qb.url+". Ensure both are up-to-date.",setTimeout(function(){throw new Error(b)},0),!1)},H=function(a,c){function d(){var a,b=[],c=[],d=" + ";a="SoundManager "+qb.version+(!qb.html5Only&&qb.useHTML5Audio?qb.hasHTML5?" + HTML5 audio":", no HTML5 audio support":""),qb.html5Only?qb.html5PollingInterval&&b.push("html5PollingInterval ("+qb.html5PollingInterval+"ms)"):(qb.preferFlash&&b.push("preferFlash"),qb.useHighPerformance&&b.push("useHighPerformance"),qb.flashPollingInterval&&b.push("flashPollingInterval ("+qb.flashPollingInterval+"ms)"),qb.html5PollingInterval&&b.push("html5PollingInterval ("+qb.html5PollingInterval+"ms)"),qb.wmode&&b.push("wmode ("+qb.wmode+")"),qb.debugFlash&&b.push("debugFlash"),qb.useFlashBlock&&b.push("flashBlock")),b.length&&(c=c.concat([b.join(d)])),qb._wD(a+(c.length?d+c.join(", "):""),1),nb()}function e(a,b){return'<param name="'+a+'" value="'+b+'" />'}if(Bb&&Cb)return!1;if(qb.html5Only)return y(),d(),qb.oMC=h(qb.movieID),k(),Bb=!0,Cb=!0,!1;var f,g,i,j,l,m,n,o,p=c||qb.url,q=qb.altURL||p,r="JS/Flash audio component (SoundManager 2)",s=G(),t=Q(),u=null,v=yb.getElementsByTagName("html")[0];if(u=v&&v.dir&&v.dir.match(/rtl/i),a=a===b?qb.id:a,y(),qb.url=N(ic?p:q),c=qb.url,qb.wmode=!qb.wmode&&qb.useHighPerformance?"transparent":qb.wmode,null!==qb.wmode&&(wb.match(/msie 8/i)||!Wb&&!qb.useHighPerformance)&&navigator.platform.match(/win32|win64/i)&&(Pb.push(A.spcWmode),qb.wmode=null),f={name:a,id:a,src:c,quality:"high",allowScriptAccess:qb.allowScriptAccess,bgcolor:qb.bgColor,pluginspage:jc+"www.macromedia.com/go/getflashplayer",title:r,type:"application/x-shockwave-flash",wmode:qb.wmode,hasPriority:"true"},qb.debugFlash&&(f.FlashVars="debug=1"),qb.wmode||delete f.wmode,Wb)g=yb.createElement("div"),j=['<object id="'+a+'" data="'+c+'" type="'+f.type+'" title="'+f.title+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+jc+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">',e("movie",c),e("AllowScriptAccess",qb.allowScriptAccess),e("quality",f.quality),qb.wmode?e("wmode",qb.wmode):"",e("bgcolor",qb.bgColor),e("hasPriority","true"),qb.debugFlash?e("FlashVars",f.FlashVars):"","</object>"].join("");else{g=yb.createElement("embed");for(i in f)f.hasOwnProperty(i)&&g.setAttribute(i,f[i])}if(K(),t=Q(),s=G())if(qb.oMC=h(qb.movieID)||yb.createElement("div"),qb.oMC.id)o=qb.oMC.className,qb.oMC.className=(o?o+" ":R.swfDefault)+(t?" "+t:""),qb.oMC.appendChild(g),Wb&&(l=qb.oMC.appendChild(yb.createElement("div")),l.className=R.swfBox,l.innerHTML=j),Cb=!0;else{if(qb.oMC.id=qb.movieID,qb.oMC.className=R.swfDefault+" "+t,m=null,l=null,qb.useFlashBlock||(qb.useHighPerformance?m={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}:(m={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"},u&&(m.left=Math.abs(parseInt(m.left,10))+"px"))),Xb&&(qb.oMC.style.zIndex=1e4),!qb.debugFlash)for(n in m)m.hasOwnProperty(n)&&(qb.oMC.style[n]=m[n]);try{Wb||qb.oMC.appendChild(g),s.appendChild(qb.oMC),Wb&&(l=qb.oMC.appendChild(yb.createElement("div")),l.className=R.swfBox,l.innerHTML=j),Cb=!0}catch(w){throw new Error(O("domError")+" \n"+w.toString())}}return Bb=!0,d(),!0},B=function(){return qb.html5Only?(H(),!1):sb?!1:qb.url?(sb=qb.getMovie(qb.id),sb||(Jb?(Wb?qb.oMC.innerHTML=Kb:qb.oMC.appendChild(Jb),Jb=null,Bb=!0):H(qb.id,qb.url),sb=qb.getMovie(qb.id)),"function"==typeof qb.oninitmovie&&setTimeout(qb.oninitmovie,1),ob(),!0):(n("noURL"),!1)},v=function(){setTimeout(w,1e3)},x=function(){a.setTimeout(function(){V(ub+"useFlashBlock is false, 100% HTML5 mode is possible. Rebooting with preferFlash: false..."),qb.setup({preferFlash:!1}).reboot(),qb.didFlashBlock=!0,qb.beginDelayedInit()},1)},w=function(){var b,c=!1;return qb.url?Lb?!1:(Lb=!0,hb.remove(a,"load",v),jb&&cc&&!bc?(n("waitFocus"),!1):(Db||(b=qb.getMoviePercent(),b>0&&100>b&&(c=!0)),void setTimeout(function(){return b=qb.getMoviePercent(),c?(Lb=!1,qb._wD(O("waitSWF")),a.setTimeout(v,1),!1):(Db||(qb._wD(tb+": No Flash response within expected time. Likely causes: "+(0===b?"SWF load failed, ":"")+"Flash blocked or JS-Flash security error."+(qb.debugFlash?" "+O("checkSWF"):""),2),!ic&&b&&(n("localFail",2),qb.debugFlash||n("tryDebug",2)),0===b&&qb._wD(O("swf404",qb.url),1),m("flashtojs",!1," (Check flash security or flash blockers)")),void(!Db&&dc&&(null===b?qb.useFlashBlock||0===qb.flashLoadTimeout?(qb.useFlashBlock&&P(),n("waitForever")):!qb.useFlashBlock&&_?x():(n("waitForever"),t({type:"ontimeout",ignoreInit:!0,error:{type:"INIT_FLASHBLOCK"}})):0===qb.flashLoadTimeout?n("waitForever"):!qb.useFlashBlock&&_?x():M(!0))))},qb.flashLoadTimeout))):!1},z=function(){function b(){hb.remove(a,"focus",z)}return bc||!cc?(b(),!0):(dc=!0,bc=!0,n("gotFocus"),Lb=!1,v(),b(),!0)},ob=function(){Pb.length&&(qb._wD("SoundManager 2: "+Pb.join(" "),1),Pb=[])},nb=function(){ob();var a,b=[];if(qb.useHTML5Audio&&qb.hasHTML5){for(a in qb.audioFormats)qb.audioFormats.hasOwnProperty(a)&&b.push(a+" = "+qb.html5[a]+(!qb.html5[a]&&Qb&&qb.flash[a]?" (using flash)":qb.preferFlash&&qb.flash[a]&&Qb?" (preferring flash)":qb.html5[a]?"":" ("+(qb.audioFormats[a].required?"required, ":"")+"and no flash support)"));qb._wD("SoundManager 2 HTML5 support: "+b.join(", "),1)}},o=function(b){if(Db)return!1;if(qb.html5Only)return n("sm2Loaded"),Db=!0,u(),m("onload",!0),!0;var c,d=qb.useFlashBlock&&qb.flashLoadTimeout&&!qb.getMoviePercent(),e=!0;return d||(Db=!0),c={type:!jb&&Qb?"NO_FLASH":"INIT_TIMEOUT"},qb._wD("SoundManager 2 "+(Eb?"failed to load":"loaded")+" ("+(Eb?"Flash security/load error":"OK")+")",Eb?2:1),Eb||b?(qb.useFlashBlock&&qb.oMC&&(qb.oMC.className=Q()+" "+(null===qb.getMoviePercent()?R.swfTimedout:R.swfError)),t({type:"ontimeout",error:c,ignoreInit:!0}),m("onload",!1),I(c),e=!1):m("onload",!0),Eb||(qb.waitForWindowLoad&&!Fb?(n("waitOnload"),hb.add(a,"load",u)):(qb.waitForWindowLoad&&Fb&&n("docLoaded"),u())),e},j=function(){var a,c=qb.setupOptions;for(a in c)c.hasOwnProperty(a)&&(qb[a]===b?qb[a]=c[a]:qb[a]!==c[a]&&(qb.setupOptions[a]=qb[a]))},k=function(){function b(){hb.remove(a,"load",qb.beginDelayedInit)}if(Db)return n("didInit"),!1;if(qb.html5Only)return Db||(b(),qb.enabled=!0,o()),!0;B();try{sb._externalInterfaceTest(!1),J(!0,qb.flashPollingInterval||(qb.useHighPerformance?10:50)),qb.debugMode||sb._disableDebug(),qb.enabled=!0,m("jstoflash",!0),qb.html5Only||hb.add(a,"unload",i)}catch(c){return qb._wD("js/flash exception: "+c.toString()),m("jstoflash",!1),I({type:"JS_TO_FLASH_EXCEPTION",fatal:!0}),M(!0),o(),!1}return o(),b(),!0},D=function(){return F?!1:(F=!0,j(),K(),function(){var a="sm2-usehtml5audio=",b="sm2-preferflash=",c=null,d=null,e=xb.toLowerCase();-1!==e.indexOf(a)&&(c="1"===e.charAt(e.indexOf(a)+a.length),ac&&console.log((c?"Enabling ":"Disabling ")+"useHTML5Audio via URL parameter"),qb.setup({useHTML5Audio:c})),-1!==e.indexOf(b)&&(d="1"===e.charAt(e.indexOf(b)+b.length),ac&&console.log((d?"Enabling ":"Disabling ")+"preferFlash via URL parameter"),qb.setup({preferFlash:d}))}(),!jb&&qb.hasHTML5&&(qb._wD("SoundManager 2: No Flash detected"+(qb.useHTML5Audio?". Trying HTML5-only mode.":", enabling HTML5."),1),qb.setup({useHTML5Audio:!0,preferFlash:!1})),gb(),!jb&&Qb&&(Pb.push(A.needFlash),qb.setup({flashLoadTimeout:1})),yb.removeEventListener&&yb.removeEventListener("DOMContentLoaded",D,!1),B(),!0)},fb=function(){return"complete"===yb.readyState&&(D(),yb.detachEvent("onreadystatechange",fb)),!0},E=function(){Fb=!0,hb.remove(a,"load",E)},C=function(){$b&&((!qb.setupOptions.useHTML5Audio||qb.setupOptions.preferFlash)&&Pb.push(A.mobileUA),qb.setupOptions.useHTML5Audio=!0,qb.setupOptions.preferFlash=!1,(Ub||Vb&&!wb.match(/android\s2\.3/i))&&(Pb.push(A.globalHTML5),Ub&&(qb.ignoreFlash=!0),Sb=!0))},C(),kb(),hb.add(a,"focus",z),hb.add(a,"load",v),hb.add(a,"load",E),yb.addEventListener?yb.addEventListener("DOMContentLoaded",D,!1):yb.attachEvent?yb.attachEvent("onreadystatechange",fb):(m("onload",!1),I({type:"NO_DOM2_EVENTS",fatal:!0}))}var d=null;void 0!==a.SM2_DEFER&&SM2_DEFER||(d=new c),a.SoundManager=c,a.soundManager=d}(window),function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=t(d,f,4);var g=!A(c)&&s.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function b(a){return function(b,c,d){c=u(c,d);for(var e=z(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function c(a,b,c){return function(d,e,f){var g=0,h=z(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(k.call(d,g,h),s.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&h>f;f+=a)if(d[f]===e)return f;return-1}}function d(a,b){var c=F.length,d=a.constructor,e=s.isFunction(d)&&d.prototype||h,f="constructor";for(s.has(a,f)&&!s.contains(b,f)&&b.push(f);c--;)f=F[c],f in a&&a[f]!==e[f]&&!s.contains(b,f)&&b.push(f)}var e=this,f=e._,g=Array.prototype,h=Object.prototype,i=Function.prototype,j=g.push,k=g.slice,l=h.toString,m=h.hasOwnProperty,n=Array.isArray,o=Object.keys,p=i.bind,q=Object.create,r=function(){},s=function(a){return a instanceof s?a:this instanceof s?void(this._wrapped=a):new s(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports._=s):e._=s,s.VERSION="1.8.3";var t=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},u=function(a,b,c){return null==a?s.identity:s.isFunction(a)?t(a,b,c):s.isObject(a)?s.matcher(a):s.property(a)};s.iteratee=function(a,b){return u(a,b,1/0)};var v=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},w=function(a){if(!s.isObject(a))return{};if(q)return q(a);r.prototype=a;var b=new r;return r.prototype=null,b},x=function(a){return function(b){return null==b?void 0:b[a]}},y=Math.pow(2,53)-1,z=x("length"),A=function(a){var b=z(a);return"number"==typeof b&&b>=0&&y>=b};s.each=s.forEach=function(a,b,c){b=t(b,c);var d,e;if(A(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=s.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},s.map=s.collect=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},s.reduce=s.foldl=s.inject=a(1),s.reduceRight=s.foldr=a(-1),s.find=s.detect=function(a,b,c){var d;return d=A(a)?s.findIndex(a,b,c):s.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},s.filter=s.select=function(a,b,c){var d=[];return b=u(b,c),s.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},s.reject=function(a,b,c){return s.filter(a,s.negate(u(b)),c)},s.every=s.all=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},s.some=s.any=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},s.contains=s.includes=s.include=function(a,b,c,d){return A(a)||(a=s.values(a)),("number"!=typeof c||d)&&(c=0),s.indexOf(a,b,c)>=0},s.invoke=function(a,b){var c=k.call(arguments,2),d=s.isFunction(b);return s.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},s.pluck=function(a,b){return s.map(a,s.property(b))},s.where=function(a,b){return s.filter(a,s.matcher(b))},s.findWhere=function(a,b){return s.find(a,s.matcher(b))},s.max=function(a,b,c){var d,e,f=-1/0,g=-1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-1/0&&f===-1/0)&&(f=a,g=e)});return f},s.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(g>e||1/0===e&&1/0===f)&&(f=a,g=e)});return f},s.shuffle=function(a){for(var b,c=A(a)?a:s.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=s.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},s.sample=function(a,b,c){return null==b||c?(A(a)||(a=s.values(a)),a[s.random(a.length-1)]):s.shuffle(a).slice(0,Math.max(0,b))},s.sortBy=function(a,b,c){return b=u(b,c),s.pluck(s.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var B=function(a){return function(b,c,d){var e={};return c=u(c,d),s.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};s.groupBy=B(function(a,b,c){s.has(a,c)?a[c].push(b):a[c]=[b]}),s.indexBy=B(function(a,b,c){a[c]=b}),s.countBy=B(function(a,b,c){s.has(a,c)?a[c]++:a[c]=1}),s.toArray=function(a){return a?s.isArray(a)?k.call(a):A(a)?s.map(a,s.identity):s.values(a):[]},s.size=function(a){return null==a?0:A(a)?a.length:s.keys(a).length},s.partition=function(a,b,c){b=u(b,c);var d=[],e=[];return s.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},s.first=s.head=s.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:s.initial(a,a.length-b)},s.initial=function(a,b,c){return k.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},s.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:s.rest(a,Math.max(0,a.length-b))},s.rest=s.tail=s.drop=function(a,b,c){return k.call(a,null==b||c?1:b)},s.compact=function(a){return s.filter(a,s.identity)};var C=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=z(a);h>g;g++){var i=a[g];if(A(i)&&(s.isArray(i)||s.isArguments(i))){b||(i=C(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};s.flatten=function(a,b){return C(a,b,!1)},s.without=function(a){return s.difference(a,k.call(arguments,1))},s.uniq=s.unique=function(a,b,c,d){s.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=u(c,d));for(var e=[],f=[],g=0,h=z(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?s.contains(f,j)||(f.push(j),e.push(i)):s.contains(e,i)||e.push(i)}return e},s.union=function(){return s.uniq(C(arguments,!0,!0))},s.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=z(a);e>d;d++){var f=a[d];if(!s.contains(b,f)){for(var g=1;c>g&&s.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},s.difference=function(a){var b=C(arguments,!0,!0,1);return s.filter(a,function(a){return!s.contains(b,a)})},s.zip=function(){return s.unzip(arguments)},s.unzip=function(a){for(var b=a&&s.max(a,z).length||0,c=Array(b),d=0;b>d;d++)c[d]=s.pluck(a,d);return c},s.object=function(a,b){for(var c={},d=0,e=z(a);e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},s.findIndex=b(1),s.findLastIndex=b(-1),s.sortedIndex=function(a,b,c,d){c=u(c,d,1);for(var e=c(b),f=0,g=z(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},s.indexOf=c(1,s.findIndex,s.sortedIndex),s.lastIndexOf=c(-1,s.findLastIndex),s.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var D=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=w(a.prototype),g=a.apply(f,e);return s.isObject(g)?g:f};s.bind=function(a,b){if(p&&a.bind===p)return p.apply(a,k.call(arguments,1));if(!s.isFunction(a))throw new TypeError("Bind must be called on a function");var c=k.call(arguments,2),d=function(){return D(a,d,b,this,c.concat(k.call(arguments)))};return d},s.partial=function(a){var b=k.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===s?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return D(a,c,this,this,f)};return c},s.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=s.bind(a[c],a);return a},s.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return s.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},s.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},s.defer=s.partial(s.delay,s,1),s.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:s.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=s.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},s.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=s.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=s.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},s.wrap=function(a,b){return s.partial(b,a)},s.negate=function(a){return function(){return!a.apply(this,arguments)}},s.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},s.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},s.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},s.once=s.partial(s.before,2);var E=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];s.keys=function(a){if(!s.isObject(a))return[];if(o)return o(a);var b=[];for(var c in a)s.has(a,c)&&b.push(c);return E&&d(a,b),b},s.allKeys=function(a){if(!s.isObject(a))return[];var b=[];for(var c in a)b.push(c);return E&&d(a,b),b},s.values=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},s.mapObject=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=e.length,g={},h=0;f>h;h++)d=e[h],g[d]=b(a[d],d,a);return g},s.pairs=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},s.invert=function(a){for(var b={},c=s.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},s.functions=s.methods=function(a){var b=[];for(var c in a)s.isFunction(a[c])&&b.push(c);return b.sort()},s.extend=v(s.allKeys),s.extendOwn=s.assign=v(s.keys),s.findKey=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},s.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;s.isFunction(b)?(e=s.allKeys(g),d=t(b,c)):(e=C(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;i>h;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},s.omit=function(a,b,c){if(s.isFunction(b))b=s.negate(b);else{var d=s.map(C(arguments,!1,!1,1),String);b=function(a,b){return!s.contains(d,b)}}return s.pick(a,b,c)},s.defaults=v(s.allKeys,!0),s.create=function(a,b){var c=w(a);return b&&s.extendOwn(c,b),c},s.clone=function(a){return s.isObject(a)?s.isArray(a)?a.slice():s.extend({},a):a},s.tap=function(a,b){return b(a),a},s.isMatch=function(a,b){var c=s.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof s&&(a=a._wrapped),b instanceof s&&(b=b._wrapped);var e=l.call(a);if(e!==l.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(s.isFunction(g)&&g instanceof g&&s.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!G(a[i],b[i],c,d))return!1}else{var j,k=s.keys(a);if(i=k.length,s.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!s.has(b,j)||!G(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};s.isEqual=function(a,b){return G(a,b)},s.isEmpty=function(a){return null==a?!0:A(a)&&(s.isArray(a)||s.isString(a)||s.isArguments(a))?0===a.length:0===s.keys(a).length},s.isElement=function(a){return!(!a||1!==a.nodeType)},s.isArray=n||function(a){return"[object Array]"===l.call(a)},s.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},s.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){s["is"+a]=function(b){return l.call(b)==="[object "+a+"]"}}),s.isArguments(arguments)||(s.isArguments=function(a){return s.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(s.isFunction=function(a){return"function"==typeof a||!1}),s.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},s.isNaN=function(a){return s.isNumber(a)&&a!==+a},s.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===l.call(a)},s.isNull=function(a){return null===a},s.isUndefined=function(a){return void 0===a},s.has=function(a,b){return null!=a&&m.call(a,b)},s.noConflict=function(){return e._=f,this},s.identity=function(a){return a},s.constant=function(a){return function(){return a}},s.noop=function(){},s.property=x,s.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},s.matcher=s.matches=function(a){return a=s.extendOwn({},a),function(b){return s.isMatch(b,a)}},s.times=function(a,b,c){var d=Array(Math.max(0,a));b=t(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},s.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},s.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=s.invert(H),J=function(a){var b=function(b){return a[b]},c="(?:"+s.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};s.escape=J(H),s.unescape=J(I),s.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),s.isFunction(d)?d.call(a):d};var K=0;s.uniqueId=function(a){var b=++K+"";return a?a+b:b},s.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,O=function(a){return"\\"+M[a]};s.template=function(a,b,c){!b&&c&&(b=c),b=s.defaults({},b,s.templateSettings);var d=RegExp([(b.escape||L).source,(b.interpolate||L).source,(b.evaluate||L).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(N,O),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,s)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},s.chain=function(a){var b=s(a);return b._chain=!0,b};var P=function(a,b){return a._chain?s(b).chain():b};s.mixin=function(a){s.each(s.functions(a),function(b){var c=s[b]=a[b];s.prototype[b]=function(){var a=[this._wrapped];return j.apply(a,arguments),P(this,c.apply(s,a))}})},s.mixin(s),s.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=g[a];s.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],P(this,c)}}),s.each(["concat","join","slice"],function(a){var b=g[a];s.prototype[a]=function(){return P(this,b.apply(this._wrapped,arguments))}}),s.prototype.value=function(){return this._wrapped},s.prototype.valueOf=s.prototype.toJSON=s.prototype.value,s.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return s})}.call(this),function(a){var b="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(c,d,e){b.Backbone=a(b,e,c,d)});else if("undefined"!=typeof exports){var c,d=require("underscore");try{c=require("jquery")}catch(e){}a(b,exports,d,c)}else b.Backbone=a(b,{},b._,b.jQuery||b.Zepto||b.ender||b.$)
}(function(a,b,c,d){var e=a.Backbone,f=Array.prototype.slice;b.VERSION="1.2.2",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var g=function(a,b,d){switch(a){case 1:return function(){return c[b](this[d])};case 2:return function(a){return c[b](this[d],a)};case 3:return function(a,e){return c[b](this[d],i(a,this),e)};case 4:return function(a,e,f){return c[b](this[d],i(a,this),e,f)};default:return function(){var a=f.call(arguments);return a.unshift(this[d]),c[b].apply(c,a)}}},h=function(a,b,d){c.each(b,function(b,e){c[e]&&(a.prototype[e]=g(b,e,d))})},i=function(a,b){return c.isFunction(a)?a:c.isObject(a)&&!b._isModel(a)?j(a):c.isString(a)?function(b){return b.get(a)}:a},j=function(a){var b=c.matches(a);return function(a){return b(a.attributes)}},k=b.Events={},l=/\s+/,m=function(a,b,d,e,f){var g,h=0;if(d&&"object"==typeof d){void 0!==e&&"context"in f&&void 0===f.context&&(f.context=e);for(g=c.keys(d);h<g.length;h++)b=m(a,b,g[h],d[g[h]],f)}else if(d&&l.test(d))for(g=d.split(l);h<g.length;h++)b=a(b,g[h],e,f);else b=a(b,d,e,f);return b};k.on=function(a,b,c){return n(this,a,b,c)};var n=function(a,b,c,d,e){if(a._events=m(o,a._events||{},b,c,{context:d,ctx:a,listening:e}),e){var f=a._listeners||(a._listeners={});f[e.id]=e}return a};k.listenTo=function(a,b,d){if(!a)return this;var e=a._listenId||(a._listenId=c.uniqueId("l")),f=this._listeningTo||(this._listeningTo={}),g=f[e];if(!g){var h=this._listenId||(this._listenId=c.uniqueId("l"));g=f[e]={obj:a,objId:e,id:h,listeningTo:f,count:0}}return n(a,b,d,this,g),this};var o=function(a,b,c,d){if(c){var e=a[b]||(a[b]=[]),f=d.context,g=d.ctx,h=d.listening;h&&h.count++,e.push({callback:c,context:f,ctx:f||g,listening:h})}return a};k.off=function(a,b,c){return this._events?(this._events=m(p,this._events,a,b,{context:c,listeners:this._listeners}),this):this},k.stopListening=function(a,b,d){var e=this._listeningTo;if(!e)return this;for(var f=a?[a._listenId]:c.keys(e),g=0;g<f.length;g++){var h=e[f[g]];if(!h)break;h.obj.off(b,d,this)}return c.isEmpty(e)&&(this._listeningTo=void 0),this};var p=function(a,b,d,e){if(a){var f,g=0,h=e.context,i=e.listeners;if(b||d||h){for(var j=b?[b]:c.keys(a);g<j.length;g++){b=j[g];var k=a[b];if(!k)break;for(var l=[],m=0;m<k.length;m++){var n=k[m];d&&d!==n.callback&&d!==n.callback._callback||h&&h!==n.context?l.push(n):(f=n.listening,f&&0===--f.count&&(delete i[f.id],delete f.listeningTo[f.objId]))}l.length?a[b]=l:delete a[b]}return c.size(a)?a:void 0}for(var o=c.keys(i);g<o.length;g++)f=i[o[g]],delete i[f.id],delete f.listeningTo[f.objId]}};k.once=function(a,b,d){var e=m(q,{},a,b,c.bind(this.off,this));return this.on(e,void 0,d)},k.listenToOnce=function(a,b,d){var e=m(q,{},b,d,c.bind(this.stopListening,this,a));return this.listenTo(a,e)};var q=function(a,b,d,e){if(d){var f=a[b]=c.once(function(){e(b,f),d.apply(this,arguments)});f._callback=d}return a};k.trigger=function(a){if(!this._events)return this;for(var b=Math.max(0,arguments.length-1),c=Array(b),d=0;b>d;d++)c[d]=arguments[d+1];return m(r,this._events,a,void 0,c),this};var r=function(a,b,c,d){if(a){var e=a[b],f=a.all;e&&f&&(f=f.slice()),e&&s(e,d),f&&s(f,[b].concat(d))}return a},s=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}};k.bind=k.on,k.unbind=k.off,c.extend(b,k);var t=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId(this.cidPrefix),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(t.prototype,k,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},matches:function(a){return!!c.iteratee(a,this)(this.attributes)},set:function(a,b,d){if(null==a)return this;var e;if("object"==typeof a?(e=a,d=b):(e={})[a]=b,d||(d={}),!this._validate(e,d))return!1;var f=d.unset,g=d.silent,h=[],i=this._changing;this._changing=!0,i||(this._previousAttributes=c.clone(this.attributes),this.changed={});var j=this.attributes,k=this.changed,l=this._previousAttributes;for(var m in e)b=e[m],c.isEqual(j[m],b)||h.push(m),c.isEqual(l[m],b)?delete k[m]:k[m]=b,f?delete j[m]:j[m]=b;if(this.id=this.get(this.idAttribute),!g){h.length&&(this._pending=d);for(var n=0;n<h.length;n++)this.trigger("change:"+h[n],this,j[h[n]],d)}if(i)return this;if(!g)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b=this._changing?this._previousAttributes:this.attributes,d={};for(var e in a){var f=a[e];c.isEqual(b[e],f)||(d[e]=f)}return c.size(d)?d:!1},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=c.extend({parse:!0},a);var b=this,d=a.success;return a.success=function(c){var e=a.parse?b.parse(c,a):c;return b.set(e,a)?(d&&d.call(a.context,b,c,a),void b.trigger("sync",b,c,a)):!1},P(this,a),this.sync("read",this,a)},save:function(a,b,d){var e;null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0,parse:!0},d);var f=d.wait;if(e&&!f){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;var g=this,h=d.success,i=this.attributes;d.success=function(a){g.attributes=i;var b=d.parse?g.parse(a,d):a;return f&&(b=c.extend({},e,b)),b&&!g.set(b,d)?!1:(h&&h.call(d.context,g,a,d),void g.trigger("sync",g,a,d))},P(this,d),e&&f&&(this.attributes=c.extend({},i,e));var j=this.isNew()?"create":d.patch?"patch":"update";"patch"!==j||d.attrs||(d.attrs=e);var k=this.sync(j,this,d);return this.attributes=i,k},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=a.wait,f=function(){b.stopListening(),b.trigger("destroy",b,b.collection,a)};a.success=function(c){e&&f(),d&&d.call(a.context,b,c,a),b.isNew()||b.trigger("sync",b,c,a)};var g=!1;return this.isNew()?c.defer(a.success):(P(this,a),g=this.sync("delete",this,a)),e||f(),g},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||O();if(this.isNew())return a;var b=this.get(this.idAttribute);return a.replace(/[^\/]$/,"$&/")+encodeURIComponent(b)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.defaults({validate:!0},a))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}});var u={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};h(t,u,"attributes");var v=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},w={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},y=function(a,b,c){for(var d=Array(a.length-c),e=b.length,f=0;f<d.length;f++)d[f]=a[f+c];for(f=0;e>f;f++)a[f+c]=b[f];for(f=0;f<d.length;f++)a[f+e+c]=d[f]};c.extend(v.prototype,k,{model:t,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,x))},remove:function(a,b){b=c.extend({},b);var d=!c.isArray(a);a=d?[a]:c.clone(a);var e=this._removeModels(a,b);return!b.silent&&e&&this.trigger("update",this,b),d?e[0]:e},set:function(a,b){if(null!=a){b=c.defaults({},b,w),b.parse&&!this._isModel(a)&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?[a]:a.slice();var e=b.at;null!=e&&(e=+e),0>e&&(e+=this.length+1);for(var f,g=[],h=[],i=[],j={},k=b.add,l=b.merge,m=b.remove,n=!1,o=this.comparator&&null==e&&b.sort!==!1,p=c.isString(this.comparator)?this.comparator:null,q=0;q<a.length;q++){f=a[q];var r=this.get(f);if(r){if(l&&f!==r){var s=this._isModel(f)?f.attributes:f;b.parse&&(s=r.parse(s,b)),r.set(s,b),o&&!n&&(n=r.hasChanged(p))}j[r.cid]||(j[r.cid]=!0,g.push(r)),a[q]=r}else k&&(f=a[q]=this._prepareModel(f,b),f&&(h.push(f),this._addReference(f,b),j[f.cid]=!0,g.push(f)))}if(m){for(q=0;q<this.length;q++)f=this.models[q],j[f.cid]||i.push(f);i.length&&this._removeModels(i,b)}var t=!1,u=!o&&k&&m;if(g.length&&u?(t=this.length!=g.length||c.some(this.models,function(a,b){return a!==g[b]}),this.models.length=0,y(this.models,g,0),this.length=this.models.length):h.length&&(o&&(n=!0),y(this.models,h,null==e?this.length:e),this.length=this.models.length),n&&this.sort({silent:!0}),!b.silent){for(q=0;q<h.length;q++)null!=e&&(b.index=e+q),f=h[q],f.trigger("add",f,this,b);(n||t)&&this.trigger("sort",this,b),(h.length||i.length)&&this.trigger("update",this,b)}return d?a[0]:a}},reset:function(a,b){b=b?c.clone(b):{};for(var d=0;d<this.models.length;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a)},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a)},slice:function(){return f.apply(this.models,arguments)},get:function(a){if(null==a)return void 0;var b=this.modelId(this._isModel(a)?a.attributes:a);return this._byId[a]||this._byId[b]||this._byId[a.cid]},at:function(a){return 0>a&&(a+=this.length),this.models[a]},where:function(a,b){return this[b?"find":"filter"](a)},findWhere:function(a){return this.where(a,!0)},sort:function(a){var b=this.comparator;if(!b)throw new Error("Cannot sort a set without a comparator");a||(a={});var d=b.length;return c.isFunction(b)&&(b=c.bind(b,this)),1===d||c.isString(b)?this.models=this.sortBy(b):this.models.sort(b),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=c.extend({parse:!0},a);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b.call(a.context,d,c,a),d.trigger("sync",d,c,a)},P(this,a),this.sync("read",this,a)},create:function(a,b){b=b?c.clone(b):{};var d=b.wait;if(a=this._prepareModel(a,b),!a)return!1;d||this.add(a,b);var e=this,f=b.success;return b.success=function(a,b,c){d&&e.add(a,c),f&&f.call(c.context,a,b,c)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(this._isModel(a))return a.collection||(a.collection=this),a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_removeModels:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=this.get(a[d]);if(e){var f=this.indexOf(e);this.models.splice(f,1),this.length--,b.silent||(b.index=f,e.trigger("remove",e,this,b)),c.push(e),this._removeReference(e,b)}}return c.length?c:!1},_isModel:function(a){return a instanceof t},_addReference:function(a){this._byId[a.cid]=a;var b=this.modelId(a.attributes);null!=b&&(this._byId[b]=a),a.on("all",this._onModelEvent,this)},_removeReference:function(a){delete this._byId[a.cid];var b=this.modelId(a.attributes);null!=b&&delete this._byId[b],this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if("add"!==a&&"remove"!==a||c===this){if("destroy"===a&&this.remove(b,d),"change"===a){var e=this.modelId(b.previousAttributes()),f=this.modelId(b.attributes);e!==f&&(null!=e&&delete this._byId[e],null!=f&&(this._byId[f]=b))}this.trigger.apply(this,arguments)}}});var z={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3};h(v,z,"models");var A=b.View=function(a){this.cid=c.uniqueId("view"),c.extend(this,c.pick(a,C)),this._ensureElement(),this.initialize.apply(this,arguments)},B=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];c.extend(A.prototype,k,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(a){return this.undelegateEvents(),this._setElement(a),this.delegateEvents(),this},_setElement:function(a){this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0]},delegateEvents:function(a){if(a||(a=c.result(this,"events")),!a)return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[d]),d){var e=b.match(B);this.delegate(e[1],e[2],c.bind(d,this))}}return this},delegate:function(a,b,c){return this.$el.on(a+".delegateEvents"+this.cid,b,c),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(a,b,c){return this.$el.off(a+".delegateEvents"+this.cid,b,c),this},_createElement:function(a){return document.createElement(a)},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"));else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className")),this.setElement(this._createElement(c.result(this,"tagName"))),this._setAttributes(a)}},_setAttributes:function(a){this.$el.attr(a)}}),b.sync=function(a,d,e){var f=D[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||O()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",f),h?h.apply(this,arguments):void 0}}"GET"===g.type||e.emulateJSON||(g.processData=!1);var i=e.error;e.error=function(a,b,c){e.textStatus=b,e.errorThrown=c,i&&i.call(e.context,a,b,c)};var j=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,j,e),j};var D={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var E=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},F=/\((.*?)\)/g,G=/(\(\?)?:\w+/g,H=/\*\w+/g,I=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(E.prototype,k,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g,d)!==!1&&(f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g))}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(I,"\\$&").replace(F,"(?:$1)?").replace(G,function(a,b){return b?a:"([^/?]+)"}).replace(H,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var J=b.History=function(){this.handlers=[],this.checkUrl=c.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},K=/^[#\/]|\s+$/g,L=/^\/+|\/+$/g,M=/#.*$/;J.started=!1,c.extend(J.prototype,k,{interval:50,atRoot:function(){var a=this.location.pathname.replace(/[^\/]$/,"$&/");return a===this.root&&!this.getSearch()},matchRoot:function(){var a=this.decodeFragment(this.location.pathname),b=a.slice(0,this.root.length-1)+"/";return b===this.root},decodeFragment:function(a){return decodeURI(a.replace(/%25/g,"%2525"))},getSearch:function(){var a=this.location.href.replace(/#.*/,"").match(/\?.+/);return a?a[0]:""},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getPath:function(){var a=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===a.charAt(0)?a.slice(1):a},getFragment:function(a){return null==a&&(a=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),a.replace(K,"")},start:function(a){if(J.started)throw new Error("Backbone.history has already been started");if(J.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(L,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var b=this.root.slice(0,-1)||"/";return this.location.replace(b+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var d=document.body,e=d.insertBefore(this.iframe,d.firstChild).contentWindow;e.document.open(),e.document.close(),e.location.hash="#"+this.fragment}var f=window.addEventListener||function(a,b){return attachEvent("on"+a,b)};return this._usePushState?f("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?f("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.options.silent?void 0:this.loadUrl()},stop:function(){var a=window.removeEventListener||function(a,b){return detachEvent("on"+a,b)};this._usePushState?a("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&a("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),J.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getHash(this.iframe.contentWindow)),a===this.fragment?!1:(this.iframe&&this.navigate(a),void this.loadUrl())},loadUrl:function(a){return this.matchRoot()?(a=this.fragment=this.getFragment(a),c.some(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})):!1},navigate:function(a,b){if(!J.started)return!1;b&&b!==!0||(b={trigger:!!b}),a=this.getFragment(a||"");var c=this.root;(""===a||"?"===a.charAt(0))&&(c=c.slice(0,-1)||"/");var d=c+a;if(a=this.decodeFragment(a.replace(M,"")),this.fragment!==a){if(this.fragment=a,this._usePushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,d);else{if(!this._wantsHashChange)return this.location.assign(d);if(this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getHash(this.iframe.contentWindow)){var e=this.iframe.contentWindow;b.replace||(e.document.open(),e.document.close()),this._updateHash(e.location,a,b.replace)}}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new J;var N=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};t.extend=v.extend=E.extend=A.extend=J.extend=N;var O=function(){throw new Error('A "url" property or function must be specified')},P=function(a,b){var c=b.error;b.error=function(d){c&&c.call(b.context,a,d,b),a.trigger("error",a,d,b)}};return b}),this.Stereo=this.Stereo||{},this.Stereo.Tmpl=this.Stereo.Tmpl||{},this.Stereo.Tmpl.artist=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<span class="artist">'+(null==(__t=artist)?"":__t)+"</span>\n";return __p},this.Stereo.Tmpl.button=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<button class="prev"></button>\n<button class="playpause"></button>\n<button class="next"></button>\n';return __p},this.Stereo.Tmpl["playlist-artist"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+=playlist.artist_url?'\n<span class="playlist-artist"><a href="'+(null==(__t=playlist.artist_url)?"":__t)+'">'+(null==(__t=playlist.artist)?"":__t)+"</a></span>\n":'\n<span class="playlist-artist">'+(null==(__t=playlist.artist)?"":__t)+"</span>\n",__p+="\n";return __p},this.Stereo.Tmpl.playlist=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<span class="playlist">\n',__p+=null!==playlist.url&&playlist.url.length>0?'\n<a href="'+(null==(__t=playlist.url)?"":__t)+'">'+(null==(__t=playlist.title)?"":__t)+"</a>\n":"\n"+(null==(__t=playlist.title)?"":__t)+"\n",__p+="\n</span>\n";return __p},this.Stereo.Tmpl.position=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<span class="progress">\n<span class="meter loaded">'+(null==(__t=loadpos)?"":__t)+'</span>\n<span class="meter played">'+(null==(__t=playpos)?"":__t)+"</span>\n</span>\n";return __p},this.Stereo.Tmpl.time=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<span class="time">\n    <span class="min">'+(null==(__t=min)?"":__t)+'</span>\n    <span class="sec">'+(null==(__t=sec)?"":__t)+"</span>\n</span>\n";return __p},this.Stereo.Tmpl.title=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<span class="title">'+(null==(__t=title)?"":__t)+"</span>\n";return __p},function(a,b,c,d){"use strict";var e;a.Stereo=a.Stereo||{},e=a.Stereo,e.e=c.clone(b.Events),e.backbone=b,e.underscore=c,"undefined"==typeof window._&&(window._=c),function(){var d=function(){throw new Error('A "url" property or function must be specified')};e.SongInfo=b.Model.extend({defaults:function(){return{id:!1,title:"",artist:"",playlist:""}},_isSynced:!1,initialize:function(){this.once("change",function(){this._isSynced=!0,this.trigger("hasInfo")})},urlRoot:function(){return e.options.urlRoot+"tracks/"},getInfo:function(a){c.isFunction(a)&&this.once("hasInfo",a),this._isSynced?this.trigger("hasInfo"):this.fetch()}}),e.Song=b.Model.extend({initialize:function(a,b){this.set("id",a.toString()),this.options=c.extend({},b),this.info=new e.SongInfo({id:this.id})},play:function(){this.snd||this.createSound(),this.snd.play()},pause:function(){this.snd&&this.snd.pause()},stop:function(){this.snd&&(this.snd.stop(),this.destroySound())},seek:function(){console.log("Seek: Not implemented")},createSound:function(){var b=this;this.snd=a.soundManager.createSound({id:this.id,url:this.url(),onload:function(){2==this.readyState?b.trigger("loaderror",this):b.trigger("load",this)},onplay:function(){b.trigger("play",this)},onresume:function(){b.trigger("resume",this)},onpause:function(){b.trigger("pause",this)},onstop:function(){b.trigger("stop",this)},onfinish:function(){b.trigger("finish",this)},onwhileloading:function(){var a=this.bytesLoaded/this.bytesTotal;b.trigger("whileloading",this,a)},onwhileplaying:function(){var a=1==this.readyState?this.durationEstimate:this.duration,c=this.position/a;b.trigger("whileplaying",this,c)}})},destroySound:function(){a.soundManager.destroySound(this.snd.id),delete this.snd},urlRoot:function(){return e.options.urlRoot+e.options.streamingSlug},url:function(){var a,b=this.id,e=c.result(this,"urlRoot")||c.result(this.collection,"url")||d();if(e){if(a=e,0===b.indexOf("http://")||0===b.indexOf("https://")||0===b.indexOf("//"))return b;0===b.indexOf("/")&&(b=b.substr(1,b.length)),a.lastIndexOf("/")!==a.length-1&&(a+="/"),b=(a&&-1!==a.lastIndexOf("/")?a.substr(0,a.lastIndexOf("/")+1):"./")+b}return b}})}(),function(){var a=function(a){var b=this.get(a);return"undefined"==typeof b?!1:this.indexOf(b)},c=function(a,b){return(b%a+a)%a},d=function(a,b){return 0===this.length?(this._index=-1,!1):(a+=b,this._repeat?(a=c(this.length,a),this._index=a,this.at(a).id):a>=this.length||0>a?(this._index=-1,!1):(this._index=a,this.at(a).id))};e.Playlist=b.Collection.extend({model:e.Song,_repeat:!0,_index:-1,getPrev:function(a){return d.call(this,a,-1)},getPrevById:function(b){var c=a.call(this,b);return!1===c?d.call(this,c,0):d.call(this,c,-1)},getNext:function(a){return d.call(this,a,1)},getNextById:function(b){var c=a.call(this,b);return!1===c?d.call(this,c,0):d.call(this,c,1)},getSafe:function(b){var c=a.call(this,b);return d.call(this,c,0)}})}(),e.playlist=new e.Playlist,e.Player=b.Model.extend({_playStateLabels:["stopped","playing","paused","loading","error"],_orphanSong:!1,playlist:e.playlist,initialize:function(){this.set("playState",0),this.set("song",!1),this.listenTo(this.playlist,"remove",function(a){a.id==this.get("song")&&(this.set("playState",0),this.set("song",!1)),a.snd&&a.destroySound()}),this.listenTo(this.playlist,"reset",function(a,b){if(1==this.get("playState")){var d=this;this._orphanSong===!1&&(this._orphanSong=c.filter(b.previousModels,function(a){return a.id==d.get("song")})[0])}}),this.listenTo(this.playlist,"add",function(){1==this.playlist.length&&0===this.get("playState")&&this.setSong(this.playlist.at(0))})},play:function(){this._play(this.getSongSafe())},pause:function(){var a=this.getSongSafe();a&&(this.set("playState",2),a.pause())},stop:function(){this._stop(this.getSongSafe())},onFinish:function(){this._orphanSong&&(this._stop(this._orphanSong),this._orphanSong=!1),this.next(),!1===this.get("song")&&this.set("playState",0)},onError:function(){this.set("playState",4)},playPause:function(a){var b=this.get("playState");a&&a!=this.get("song")&&(b>0&&this.stop(),b=0,this.setSong(a)),1==b?this.pause():this.play()},prev:function(){this._prevNext(-1)},next:function(){this._prevNext(1)},isPlaying:function(){return 1==this.get("playState")},isStopped:function(){return 0===this.get("playState")},isPaused:function(){return 2==this.get("playState")},_play:function(a){a?(this.listenToOnce(a,"finish",this.onFinish),this.listenToOnce(a,"loaderror",this.onError),this.set("playState",3),this.listenToOnce(a,"play resume",function(){this.set("playState",1)}),a.play()):this.set("playState",0)},_stop:function(a){a&&(this.set("playState",0),this.stopListening(a),a.stop()),this._orphanSong=!1},_prevNext:function(a){var b;this._stop(this.getSong()),b=0>a?this.playlist.getPrevById(this.get("song")):this.playlist.getNextById(this.get("song")),this.set("song",b),this._play(this.getSong())},getSong:function(){var a=this._orphanSong!==!1?this._orphanSong:this.playlist.get(this.get("song"));return a||!1},getSongSafe:function(){var a=this._orphanSong!==!1?this._orphanSong:this.playlist.get(this.get("song"));return a?a:(a=this.playlist.getSafe(this.get("song")),this.set("song",a),this.playlist.get(a))},setSong:function(a){var b=this.playlist.get(a);b=b?b.id:!1,this.set("song",b)},getPlayStateLabel:function(a){return a=void 0===a?this.get("playState"):a,this._playStateLabels[a]}}),e.player=new e.Player,e.View={},e.View.Buttons=b.View.extend({template:e.Tmpl.button,model:e.player,className:"stereo-buttons",events:{"click .prev":function(){this.model.prev()},"click .stop":function(){this.model.stop()},"click .play":function(){this.model.play()},"click .playpause":function(){this.model.playPause()},"click .pause":function(){this.model.pause()},"click .next":function(){this.model.next()}},initialize:function(){this.listenTo(this.model,"change",this.render),this.render()},render:function(){return this.$el.html(this.template()),this}}),e.View.Label=b.View.extend({template:function(a){var b="";return c.each(e.options.controls.label_order,function(c){b+=e.Tmpl[c](a)}),b},className:"stereo-label",model:e.player,song:!1,$current:!1,ticker:!1,initialize:function(){this.listenTo(this.model,"change",this.changeSong)},changeSong:function(){this.model.hasChanged("song")&&(this.song!==!1&&this.stopListening(this.song),this.song=this.model.getSong(),this.listenToOnce(this.song.info,"hasInfo",this.render),this.listenTo(this.song,"loaderror",this.renderError),this.song.info.getInfo())},renderError:function(){this.stopListening(this.song.info),this.$el.html("<span class='load-error'>Error loading file</span>")},render:function(){return this.song!==!1&&(this.$el.html(this.template(this.song.info.attributes)),e.options.controls.labelTicker?this.$el.children(":visible").length>1&&(this.$current=this.$el.children(":first:visible").css("top","100%").animate({top:0},400),this.animate()):this.$el.css("display","none").fadeIn(100)),this},animate:function(){a.clearInterval(this.ticker),this.ticker=a.setInterval(c.bind(this.tick,this),4e3)},tick:function(){this.$current.animate({top:"-100%"},200),this.$current=this.$current.siblings(":visible").first().length>0?this.$current.siblings(":visible").first():this.$current.siblings().first(":visible"),this.$current.css("top","100%").animate({top:0},400)}}),e.View.ContinousSongData=b.View.extend({model:e.player,song:!1,initialize:function(){this.listenTo(this.model,"change",this.changeSong)},changeSong:function(){this.model.hasChanged("song")&&(this.song&&this.stopListening(this.song),this.song=this.model.getSong(),this.song?(this.listenTo(this.song,"whileloading",this.render),this.listenTo(this.song,"whileplaying",this.render)):this.empty())},empty:function(){},render:function(){return this}}),e.View.Position=e.View.ContinousSongData.extend({initialize:function(){this.data={},this.listenTo(this.model,"change",this.changeSong)},className:"stereo-position",template:e.Tmpl.position}),e.View.Time=e.View.ContinousSongData.extend({className:"stereo-time",template:e.Tmpl.time}),e.View.ClassChanger=b.View.extend({_changeActive:function(){this.model.get("song")!=this.url?this.el.className=this.className:this.$el.addClass("active")},_changePlayState:function(){this.url&&this.model.get("song")!=this.url||this.$el.removeClass(this.model.getPlayStateLabel(this.model.previous("playState"))).addClass(this.model.getPlayStateLabel())
},_initClass:function(){this._changeActive(),this._changePlayState()},_doChangeClass:function(a){a&&this.model.hasChanged("song")&&this._changeActive(a),this.model.hasChanged("playState")&&this._changePlayState()}}),e.View.Controls=e.View.ClassChanger.extend({className:"stereo-controls",views:{},initialize:function(a){var b=this;return this.model=e.player,this.$el.addClass(this.className),c.each(a.order,function(a){b.views[a]=new e.View[a],b.views[a].render(),b.$el.append(b.views[a].$el)}),this.listenTo(this.model,"change",this.changeClass),this},changeClass:function(){return this._doChangeClass(),this}}),e.View.PlaylistItem=e.View.ClassChanger.extend({initialize:function(a){this.model=e.player,this.className=this.className||this.el.className,a.url||(a.url=this.$el.data("stereo-track")),this.url=a.url,this.template=a.template,this.listenTo(this.model,"change",this.changeClass),this._initClass()},events:{click:function(a){a.preventDefault(),this.model.playlist.get(this.url)||this.model.playlist.add(this.url),this.model.playPause(this.url)}},changeClass:function(){this._doChangeClass(this.url)}}),e.views={},e.options||(e.options={}),e.options=c.extend({urlRoot:"./_mp3/",streamingSlug:"stream",doInit:!0,playlist:{onload:!1,repeat:!0,shuffle:!1},controls:{elements:"#stereo_controls",order:["Buttons","Label","Position","Time"],label_order:["title","playlist-artist","playlist"],labelTicker:!1},links:{elements:"[data-stereo-track]"},sm:{},default_tracks:!1},e.options),e.init=function(a){var b=function(a,b,e){c.each(b,function(a){a.remove()}),b.length=0,d(a).each(e)};if(a=c.extend({},e.options,a),a.controls&&a.controls.elements&&(e.views.controls=[],b(a.controls.elements,e.views.controls,function(){e.views.controls.push(new e.View.Controls({el:this,order:a.controls.order}))})),a.links&&a.links.elements&&(e.views.links=[],e.e.on("init history:load-finish",function(c){var f=!0;!1!==c&&b(a.links.elements,e.views.links,function(){f&&(e.playlist.reset(),f=!1),e.views.links.push(new e.View.PlaylistItem({el:this})),e.playlist.add(d(this).data("stereo-track"))})})),a.default_tracks){var f=a.default_tracks;"random"==f.default_track_mode&&(f.tracks=c.shuffle(f.tracks).slice(0,Math.max(0,f.track_count))),e.playlist.add(f.tracks)}e.e.trigger("init",a)},a.soundManager.setup(e.options.sm),a.soundManager.onload=function(){e.options.doInit&&e.init()}}(window,Backbone.noConflict(),_.noConflict(),jQuery),function(a,b){"use strict";var c,d,e;a.Stereo=a.Stereo||{},c=a.Stereo,d=c.backbone,e=c.underscore,d.History.prototype.navigate=function(b,c){if(!d.History.started)return!1;c&&c!==!0||(c={trigger:!!c});var e=this.root+(b=this.getFragment(b||""));if(this.fragment!==b)return this.fragment=b,""===b&&"/"!==e&&(e=e.slice(0,-1)),this._hasPushState?(this.history[c.replace?"replaceState":"pushState"]({},a.document.title,e),c.trigger?this.loadUrl(b):void 0):this.location.assign(e)},c.HistoryRouter=d.Router.extend({initialize:function(){var e=this;b(function(){d.history.start({pushState:!0,hashChange:!1,silent:!0,root:c.options.history.urlRoot.replace(/^.*\/\/[^\/]*/,"")}),e.navigate(a.location.pathname+a.location.hash)})},routes:{"*page":"newPage"},newPage:function(){c.e.trigger("history:load-start",a.location.pathname+a.location.hash)}}),function(){var e=function(a){var b=String(a).replace(/<\!DOCTYPE[^>]*>/i,"").replace(/<(html|head|body|title|meta)([\s\>])/gi,'<div data-history-$1="true"$2').replace(/<\/(html|head|body|title|meta)\>/gi,"</div>");return b};c.View.History=d.View.extend({initialize:function(){var d=b("html,body"),e=c.options.links.elements?[c.options.links.elements]:[];e.push('[target="_blank"]'),c.options.history.ignore&&e.push(c.options.history.ignore),this.listenTo(c.e,"history:load-start",this.onNewPage),this.listenTo(c.e,"history:load-finish",function(){c.e.trigger("history:scroll")}),this.listenTo(c.e,"history:scroll",function(){var e,f=a.location.hash,g=b(f);0===g.length&&(g=f.length<=1?d:b("[name="+f.slice(1)+"]")),e=g.length?g.offset().top:0,d.animate({scrollTop:e},c.options.history.scrollTime,function(){""!==f&&(a.location.hash=f)})}),this.$el.on("click","a:nomedia:internalLink:not("+e.join(",")+")",this.navigateLink).append('<div class="stereo-spinner"/>')},navigateLink:function(b){var d=this.href;if(a.location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&a.location.hostname==this.hostname)c.historyRouter.navigate(d.replace(c.options.history.urlRoot,"")),c.e.trigger("history:scroll");else{if(2==b.which||b.metaKey||b.shiftKey||!1===c.player.isPlaying())return;var e=d.replace(c.options.history.urlRoot,"");c.historyRouter.navigate(e),c.historyRouter.newPage(e)}b.stopPropagation(),b.preventDefault()},onNewPage:function(d){var f=this.$el;f.addClass("stereo-loading"),d&&b.ajax({url:d,data:{stereo_ajax:!0},dataType:"html",success:function(g,h,i){var j,k;if(-1==i.getResponseHeader("Content-Type").indexOf("html"))return void(a.location=d);j=b(b.trim(e(g))),k=j.find("[data-history-body]"),f.removeClass(),f.addClass("body"==c.options.history.container?k.attr("class"):k.find(c.options.history.container)),b(c.options.history.elements).stop(!0,!0).each(function(){b(this).each(function(){var a=b(this),c=k.find("#"+a.attr("id"));a.html(c.html()).removeClass().addClass(c.attr("class"))})}),a.document.title=j.find("[data-history-title]:first").text();try{a.document.getElementsByTagName("title")[0].innerHTML=a.document.title.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(l){}c.e.trigger("history:load-data",j),f.removeClass("stereo-loading"),c.e.trigger("history:load-finish",!0)},error:function(){c.e.trigger("history:load-finish",!1),a.document.location.href=d}})}})}(),c.e.on("init",function(a){c.options.history=e.extend({urlRoot:"http://jb.dev",container:"body",elements:"#content",ignore:"",scrollTime:0,enable:!1},a.history),a.history.enable&&a.history.elements&&(c.historyRouter=new c.HistoryRouter,c.views.history=[],b(a.history.container).each(function(){c.views.history.push(new c.View.History({el:this}))}))}),b.expr[":"].internalLink=function(b){var c="A"==b.nodeName&&b.hostname==a.location.hostname&&!b.href.match(/^mailto\:/);return c},b.expr[":"].nomedia=function(a){return"A"==a.nodeName&&(!a.href.match(/\.([a-z]{2,4}$)/i)||a.href.match(/\.([psx]?htm[l]?|php[34]?)/gi))}}(window,jQuery);